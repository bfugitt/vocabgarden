<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Garden</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, .font-serif { font-family: 'Merriweather', serif; }
        
        /* Custom Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 0 0 rgba(250, 204, 21, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(250, 204, 21, 0); } }
        .animate-glow { animation: pulse-glow 2s infinite; }
        
        @keyframes pulse-slow { 0%, 100% { opacity: 1; } 50% { opacity: 0.8; } }
        .animate-pulse-slow { animation: pulse-slow 3s infinite; }

        /* Flip Card Styles */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .card-inner { transition: transform 0.6s; }
        .flipped .card-inner { transform: rotateY(180deg); }

        /* Paper Pattern */
        .bg-paper-pattern {
            background-image: radial-gradient(#d6d3d1 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f5f5f4; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #d6d3d1; border-radius: 20px; }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 selection:bg-amber-100 min-h-screen flex flex-col">

    <!-- MAIN APP CONTAINER -->
    <main id="app" class="flex-grow flex flex-col items-center justify-center w-full p-4">
        <!-- Content will be injected here by JavaScript -->
    </main>

    <footer class="p-4 text-center text-stone-400 text-sm">
        <p>Vocabulary Garden â€¢ <span id="unit-count-display">0</span> Units Active</p>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // --- 1. DATA CONFIGURATION ---
     
   const RAW_DATA = [
        // UNIT 1
        { u: 1, w: "celebrity", d: "A famous person.", s: "star, famous person", a: "unknown, nobody", ex: "The singer is a huge ______ with millions of fans." },
        { u: 1, w: "counsel", d: "To give advice; advice.", s: "advise, guidance", a: "ignore, disregard", ex: "The coach offered wise ______ on how to win the game." },
        { u: 1, w: "demonstrate", d: "To show clearly or explain.", s: "show, prove", a: "hide, conceal", ex: "Can you ______ how to solve that math problem?" },
        { u: 1, w: "drowsy", d: "Feeling sleepy or tired.", s: "sleepy, tired", a: "alert, awake", ex: "The warm milk made the baby feel ______." },
        { u: 1, w: "essential", d: "Completely necessary or important.", s: "necessary, vital", a: "unnecessary, optional", ex: "A helmet is ______ for riding a bike safely." },
        { u: 1, w: "hardship", d: "A difficulty or trouble.", s: "difficulty, suffering", a: "ease, comfort", ex: "The pioneers faced many ______ during their journey." },
        { u: 1, w: "haul", d: "To pull or drag with effort.", s: "drag, pull", a: "push, carry lightly", ex: "We had to ______ the heavy logs up the hill." },
        { u: 1, w: "humble", d: "Not proud; modest; simple.", s: "modest, plain", a: "proud, arrogant", ex: "Despite his success, he remained a very ______ man." },
        { u: 1, w: "pledge", d: "A serious promise.", s: "promise, vow", a: "break, deny", ex: "I made a ______ to always tell the truth." },
        { u: 1, w: "sincere", d: "Honest and truthful.", s: "honest, genuine", a: "fake, insincere", ex: "Her apology was ______, so I forgave her." },
        { u: 1, w: "stampede", d: "A sudden rush of startled animals or people.", s: "rush, bolt", a: "retreat, calm", ex: "The loud noise caused a ______ of cattle." },
        { u: 1, w: "suitable", d: "Right for a certain purpose; proper.", s: "appropriate, fitting", a: "unsuitable, wrong", ex: "These shoes are not ______ for hiking." },
        
        // --- PASTE YOUR UNITS 2-17 HERE ---
        
    // UNIT 2
    { u: 2, w: "annual", d: "Happening once a year.", s: "yearly, periodic", a: "daily, never", ex: "The town holds an ______ summer festival in July." },
    { u: 2, w: "basic", d: "Simple or fundamental.", s: "simple, main", a: "complex, advanced", ex: "Learning to read is a ______ skill for life." },
    { u: 2, w: "competition", d: "A contest or rivalry.", s: "contest, challenge", a: "cooperation, agreement", ex: "The two teams were in a tough ______ for the trophy." },
    { u: 2, w: "contract", d: "A written agreement.", s: "agreement, deal", a: "disagreement, breakup", ex: "They signed a ______ to buy the new house." },
    { u: 2, w: "dismiss", d: "To send away or let go.", s: "fire, let go", a: "hire, keep", ex: "The teacher had to ______ the student for bad behavior." },
    { u: 2, w: "neglect", d: "To fail to take care of something.", s: "ignore, abandon", a: "care for, attend to", ex: "If you ______ your homework, your grades will fall." },
    { u: 2, w: "obtain", d: "To get or acquire.", s: "get, gain", a: "lose, forfeit", ex: "She worked hard to ______ a good grade on the test." },
    { u: 2, w: "portion", d: "A part or share of something.", s: "share, part", a: "whole, entirety", ex: "I saved a small ______ of my dessert for later." },
    { u: 2, w: "recall", d: "To remember something.", s: "remember, recollect", a: "forget, overlook", ex: "I couldn't ______ the name of the movie we watched." },
    { u: 2, w: "sponsor", d: "A person or group who supports another.", s: "supporter, backer", a: "opponent, rival", ex: "A local business agreed to ______ the school's field day." },
    { u: 2, w: "stern", d: "Strict or serious.", s: "serious, strict", a: "gentle, easygoing", ex: "The principal gave a ______ warning about running in the halls." },
    { u: 2, w: "vacant", d: "Empty; not filled or occupied.", s: "empty, unoccupied", a: "occupied, full", ex: "The apartment has been ______ since the last tenants moved out." },

    // UNIT 3
    { u: 3, w: "attractive", d: "Pleasing to the eye or mind.", s: "pretty, appealing", a: "ugly, repulsive", ex: "The brightly colored flowers were very ______." },
    { u: 3, w: "burden", d: "A heavy load; something difficult to carry.", s: "load, worry", a: "ease, relief", ex: "The heavy backpack was a big ______ on the small child." },
    { u: 3, w: "consent", d: "To agree to something; agreement.", s: "agree, permission", a: "refuse, denial", ex: "You need your parents' ______ to go on the trip." },
    { u: 3, w: "dependable", d: "Trustworthy; reliable.", s: "reliable, trustworthy", a: "unreliable, shaky", ex: "A good friend should always be ______." },
    { u: 3, w: "indicate", d: "To point out or show.", s: "show, point to", a: "hide, conceal", ex: "The sign will ______ where the museum is located." },
    { u: 3, w: "previous", d: "Happening before or earlier.", s: "former, preceding", a: "next, following", ex: "We reviewed the material from the ______ chapter." },
    { u: 3, w: "qualify", d: "To meet the requirements or be fit for something.", s: "meet requirements, fit", a: "disqualify, be unfit", ex: "You need a license to ______ to drive a car." },
    { u: 3, w: "response", d: "An answer or reply.", s: "answer, reply", a: "question, query", ex: "I sent an email and waited for a ______." },
    { u: 3, w: "shabby", d: "Worn out or old-looking.", s: "worn, ragged", a: "new, clean", ex: "The old couch looked ______ and needed a new cover." },
    { u: 3, w: "thaw", d: "To melt or warm up.", s: "melt, defrost", a: "freeze, solidify", ex: "The snow began to ______ as the sun came out." },

    // UNIT 4
    { u: 4, w: "ambush", d: "A surprise attack from a hidden position.", s: "trap, surprise attack", a: "open attack, stand down", ex: "The soldiers planned an ______ in the thick woods." },
    { u: 4, w: "calculate", d: "To figure out using math.", s: "figure out, compute", a: "guess, estimate", ex: "I need to ______ how much paint we need for the room." },
    { u: 4, w: "contribute", d: "To give to a common purpose.", s: "donate, give", a: "take, withhold", ex: "Everyone should ______ a little money to the school fundraiser." },
    { u: 4, w: "dread", d: "To fear greatly or look forward to with fear.", s: "fear, worry", a: "welcome, anticipate happily", ex: "She ______ having to speak in front of the whole class." },
    { u: 4, w: "employ", d: "To hire someone for work.", s: "hire, use", a: "fire, dismiss", ex: "The company will ______ twenty new workers this year." },
    { u: 4, w: "extend", d: "To stretch out or make longer.", s: "lengthen, stretch", a: "shorten, contract", ex: "Can you ______ your arm so I can reach your hand?" },
    { u: 4, w: "frantic", d: "Wildly excited or worried.", s: "desperate, worried", a: "calm, peaceful", ex: "We made a ______ search for the lost car keys." },
    { u: 4, w: "initial", d: "First or beginning.", s: "beginning, starting", a: "final, last", ex: "The ______ plan was different from the final one." },
    { u: 4, w: "routine", d: "A regular, fixed way of doing things.", s: "schedule, habit", a: "random, unusual", ex: "Brushing your teeth is part of your daily ______." },
    { u: 4, w: "stun", d: "To shock or surprise greatly.", s: "amaze, daze", a: "bore, calm", ex: "The amazing magic trick completely ______ the audience." },
    { u: 4, w: "sturdy", d: "Strong and well-made.", s: "strong, solid", a: "weak, flimsy", ex: "The oak table was ______ and would last for years." },
    { u: 4, w: "yield", d: "To produce or give way to.", s: "produce, surrender", a: "keep, hold onto", ex: "The garden will ______ many fresh vegetables this summer." },

    // UNIT 5
    { u: 5, w: "antique", d: "Very old and valuable.", s: "old, vintage", a: "new, modern", ex: "She bought an ______ clock at the flea market." },
    { u: 5, w: "baggage", d: "Suitcases and belongings for travel.", s: "luggage, bags", a: "excess, clutter", ex: "We put all of our ______ in the trunk of the car." },
    { u: 5, w: "digest", d: "To break down food in the stomach.", s: "process, absorb", a: "reject, ignore", ex: "It takes time for your stomach to ______ a large meal." },
    { u: 5, w: "establish", d: "To set up or start.", s: "create, found", a: "demolish, end", ex: "They hope to ______ a new school in the neighborhood." },
    { u: 5, w: "eternal", d: "Lasting forever; endless.", s: "everlasting, endless", a: "temporary, short-lived", ex: "Many people believe the stars are a sign of ______ peace." },
    { u: 5, w: "haste", d: "Speed or quickness.", s: "hurry, rush", a: "slowness, delay", ex: "They finished the project in ______ and made many mistakes." },
    { u: 5, w: "humid", d: "Having a lot of moisture or water vapor in the air.", s: "damp, moist", a: "dry, arid", ex: "The air was hot and ______ right before the thunderstorm." },
    { u: 5, w: "lash", d: "To tie down or fasten securely.", s: "tie, fasten", a: "unfasten, untie", ex: "Make sure to ______ the boat to the dock with a strong rope." },
    { u: 5, w: "oppose", d: "To be against something.", s: "resist, fight", a: "support, agree with", ex: "Most of the students ______ the idea of longer school days." },
    { u: 5, w: "pioneer", d: "A person who goes first and settles a new land.", s: "settler, trailblazer", a: "follower, successor", ex: "The ______ traveled West to start a new life." },
    { u: 5, w: "sensible", d: "Showing good judgment or common sense.", s: "practical, wise", a: "foolish, illogical", ex: "Wearing a warm coat in winter is a ______ idea." },
    { u: 5, w: "worthy", d: "Deserving of respect or attention.", s: "deserving, excellent", a: "unworthy, bad", ex: "He proved himself to be a ______ leader for the class." },

    // UNIT 6
    { u: 6, w: "blossom", d: "A flower or to flower.", s: "bloom, flower", a: "fade, wither", ex: "The apple trees began to ______ in the spring." },
    { u: 6, w: "collide", d: "To crash into each other.", s: "crash, strike", a: "avoid, miss", ex: "Two cars ______ on the icy road." },
    { u: 6, w: "constant", d: "Happening all the time; never-ending.", s: "continuous, steady", a: "irregular, brief", ex: "The ______ noise from the construction site was annoying." },
    { u: 6, w: "content", d: "Happy and satisfied.", s: "satisfied, pleased", a: "unhappy, displeased", ex: "After a good meal, the baby felt ______ and fell asleep." },
    { u: 6, w: "distract", d: "To pull attention away from something.", s: "divert, bother", a: "focus, concentrate", ex: "Don't let the noise ______ you from your schoolwork." },
    { u: 6, w: "drought", d: "A long period without rain.", s: "dryness, lack of rain", a: "flood, downpour", ex: "The farm crops wilted during the long summer ______." },
    { u: 6, w: "foul", d: "Offensive or disgusting; against the rules.", s: "gross, wrong", a: "pleasant, fair", ex: "The rotten eggs had a ______ smell." },
    { u: 6, w: "noble", d: "High in moral quality; a high-ranking person.", s: "honorable, royal", a: "dishonorable, common", ex: "The knight performed a ______ act by saving the child." },
    { u: 6, w: "policy", d: "A rule or plan of action.", s: "rule, plan", a: "disorder, exception", ex: "The school has a strict ______ about being on time." },
    { u: 6, w: "quiver", d: "To tremble or shake slightly.", s: "shake, shiver", a: "stay still, calm", ex: "The tiny mouse began to ______ with fear." },
    { u: 6, w: "slight", d: "Small in amount; minor.", s: "small, minor", a: "large, huge", ex: "There was only a ______ chance of rain today." },
    { u: 6, w: "tidy", d: "Neat and orderly.", s: "neat, organized", a: "messy, disorganized", ex: "Please make sure your bedroom is ______ before playing games." },

    // UNIT 7
    { u: 7, w: "accurate", d: "Exactly correct; without mistakes.", s: "correct, exact", a: "wrong, false", ex: "She used a ruler to make sure her measurements were ______." },
    { u: 7, w: "alert", d: "Watchful and ready.", s: "watchful, attentive", a: "asleep, unaware", ex: "A good guard dog is always ______ for danger." },
    { u: 7, w: "ancestor", d: "A relative who lived in the past.", s: "forebear, relative", a: "descendant, offspring", ex: "My ______ came to this country many years ago." },
    { u: 7, w: "disaster", d: "A sudden event that causes great damage.", s: "catastrophe, tragedy", a: "blessing, success", ex: "The earthquake was a terrible ______ for the city." },
    { u: 7, w: "elementary", d: "Basic or simple.", s: "simple, beginning", a: "advanced, complex", ex: "First grade is the beginning of ______ school." },
    { u: 7, w: "envy", d: "To want what someone else has.", s: "jealousy, desire", a: "contentment, satisfaction", ex: "I felt ______ for my friend's brand-new bicycle." },
    { u: 7, w: "epidemic", d: "A sudden, widespread outbreak of a disease.", s: "outbreak, plague", a: "cure, rarity", ex: "A severe flu caused a widespread ______ in the city." },
    { u: 7, w: "feeble", d: "Weak and without strength.", s: "weak, frail", a: "strong, powerful", ex: "The sick man was too ______ to get out of bed." },
    { u: 7, w: "penetrate", d: "To go into or through something.", s: "pierce, bore", a: "exit, pull out", ex: "The sharp thorn managed to ______ the thick leather glove." },
    { u: 7, w: "romp", d: "To play or move in a lively, spirited way.", s: "play, frolic", a: "rest, walk slowly", ex: "The puppies ______ happily in the tall grass." },
    { u: 7, w: "staple", d: "A basic or necessary item.", s: "essential, main product", a: "extra, luxury", ex: "Rice is a ______ food in many countries." },
    { u: 7, w: "survive", d: "To stay alive or continue to exist.", s: "live, endure", a: "perish, die", ex: "Very few animals can ______ in the cold desert at night." },

    // UNIT 8
    { u: 8, w: "awkward", d: "Clumsy or difficult to handle.", s: "clumsy, uncomfortable", a: "graceful, smooth", ex: "Carrying three big boxes was an ______ task." },
    { u: 8, w: "clatter", d: "A loud, rattling noise.", s: "noise, racket", a: "silence, quiet", ex: "The plates made a loud ______ when they fell off the shelf." },
    { u: 8, w: "gallant", d: "Brave and heroic.", s: "brave, heroic", a: "cowardly, fearful", ex: "The ______ knight defended the castle from the dragon." },
    { u: 8, w: "lukewarm", d: "Slightly warm; neither hot nor cold.", s: "tepid, mild", a: "hot, icy", ex: "The tea was only ______ and needed to be heated up." },
    { u: 8, w: "plentiful", d: "Existing in large supply.", s: "abundant, ample", a: "scarce, rare", ex: "Wild berries are ______ in the forest during summer." },
    { u: 8, w: "ration", d: "A fixed amount of something allowed to a person.", s: "allowance, share", a: "entire amount, excess", ex: "During the war, the government had to ______ food." },
    { u: 8, w: "reserve", d: "To hold back or save for later.", s: "save, hold", a: "use, spend", ex: "We must ______ a table at the restaurant ahead of time." },
    { u: 8, w: "scholar", d: "A person who studies a lot and knows a lot.", s: "learned person, expert", a: "beginner, ignorant person", ex: "She is a brilliant ______ in the field of ancient history." },
    { u: 8, w: "smolder", d: "To burn slowly with smoke but no flame.", s: "burn, smoke", a: "flare, extinguish", ex: "The campfire began to ______ after the flames went out." },
    { u: 8, w: "trudge", d: "To walk slowly and with heavy steps.", s: "lumber, plod", a: "skip, walk quickly", ex: "We had to ______ through the deep, wet snow." },
    { u: 8, w: "volunteer", d: "A person who offers to do a service freely.", s: "helper, unpaid worker", a: "paid worker, forced labor", ex: "I decided to ______ my time at the animal shelter." },
    { u: 8, w: "weary", d: "Physically or mentally tired.", s: "tired, exhausted", a: "energetic, refreshed", ex: "The long hike made my legs feel ______." },

    // UNIT 9
    { u: 9, w: "convict", d: "To find someone guilty of a crime.", s: "find guilty, sentence", a: "acquit, pardon", ex: "The jury voted to ______ the suspect of the crime." },
    { u: 9, w: "discipline", d: "Training to obey rules; self-control.", s: "obedience, training", a: "chaos, disorder", ex: "Learning to play an instrument takes great ______." },
    { u: 9, w: "dungeon", d: "A dark, underground prison cell.", s: "jail, cell", a: "sky, freedom", ex: "The prisoner was locked away in the castle's ______." },
    { u: 9, w: "earnest", d: "Serious and sincere.", s: "serious, sincere", a: "playful, shallow", ex: "She made an ______ effort to study for the difficult exam." },
    { u: 9, w: "enclose", d: "To surround or close off on all sides.", s: "surround, fence in", a: "open, release", ex: "They will ______ the yard with a wooden fence." },
    { u: 9, w: "gradual", d: "Happening slowly over a long period.", s: "slow, steady", a: "sudden, rapid", ex: "The change in the weather was ______ as winter arrived." },
    { u: 9, w: "grumble", d: "To complain in a low voice.", s: "complain, mutter", a: "cheer, praise", ex: "He began to ______ about having to clean his room." },
    { u: 9, w: "jagged", d: "Having sharp, uneven points.", s: "rough, spiky", a: "smooth, even", ex: "The broken glass left a ______ edge on the table." },
    { u: 9, w: "nourish", d: "To provide food or support for growth.", s: "feed, nurture", a: "starve, neglect", ex: "Good food and rest will ______ a growing child." },
    { u: 9, w: "provision", d: "A supply of necessary items, especially food.", s: "supply, arrangement", a: "lack, scarcity", ex: "We bought extra food and ______ for the long camping trip." },
    { u: 9, w: "treaty", d: "A formal agreement between two or more countries.", s: "agreement, pact", a: "disagreement, conflict", ex: "The two nations signed a peace ______ to end the war." },
    { u: 9, w: "uneasy", d: "Feeling worried or uncomfortable.", s: "worried, anxious", a: "calm, relaxed", ex: "I felt ______ when I was home alone in the dark." },

    // UNIT 10
    { u: 10, w: "distress", d: "Great pain, suffering, or sadness.", s: "pain, trouble", a: "comfort, joy", ex: "The stranded hikers were in great ______." },
    { u: 10, w: "drench", d: "To make completely wet.", s: "soak, saturate", a: "dry, parch", ex: "The sudden rainstorm will ______ everyone who is outside." },
    { u: 10, w: "dwell", d: "To live in a place.", s: "live, reside", a: "move, leave", ex: "I have always wished to ______ in a house near the ocean." },
    { u: 10, w: "juvenile", d: "Relating to young people; a young person.", s: "young, youthful", a: "adult, mature", ex: "The crime committed by the teenager was a ______ offense." },
    { u: 10, w: "outstanding", d: "Excellent or very noticeable.", s: "excellent, amazing", a: "bad, average", ex: "She gave an ______ performance in the school play." },
    { u: 10, w: "proceed", d: "To move forward or go on.", s: "continue, advance", a: "stop, retreat", ex: "We waited for the light to turn green before we could ______." },
    { u: 10, w: "register", d: "To record or enroll officially.", s: "sign up, enroll", a: "withdraw, forget", ex: "You need to ______ to vote in the upcoming election." },
    { u: 10, w: "sift", d: "To put a fine material through a strainer.", s: "strain, filter", a: "lump, combine", ex: "You should always ______ the flour before baking a cake." },
    { u: 10, w: "spree", d: "A lively or wild outburst of activity.", s: "binge, burst", a: "scarcity, lack", ex: "They went on a shopping ______ and spent all their money." },
    { u: 10, w: "tardy", d: "Late; not on time.", s: "late, delayed", a: "early, on time", ex: "Students who are ______ will need to get a note from the office." },
    { u: 10, w: "unfit", d: "Not suitable or good enough.", s: "unsuitable, unhealthy", a: "suitable, fit", ex: "Eating too much junk food will make you ______ for sports." },
    { u: 10, w: "variety", d: "A number of different kinds.", s: "assortment, mix", a: "same, uniformity", ex: "The store offers a large ______ of fresh fruits and vegetables." },

    // UNIT 11
    { u: 11, w: "blockade", d: "A barrier that prevents movement.", s: "barrier, stop", a: "opening, path", ex: "The fallen tree created a ______ across the main road." },
    { u: 11, w: "chant", d: "To sing or say in a repeating, rhythmic way.", s: "sing, repeat", a: "whisper, speak softly", ex: "The crowd began to ______ the name of their favorite player." },
    { u: 11, w: "despair", d: "A feeling of complete lack of hope.", s: "hopelessness, sadness", a: "hope, happiness", ex: "After losing his dog, he fell into deep ______." },
    { u: 11, w: "elevate", d: "To lift or raise to a higher position.", s: "lift, raise", a: "lower, drop", ex: "We used a crane to ______ the materials to the roof." },
    { u: 11, w: "extraordinary", d: "Beyond the usual; remarkable.", s: "amazing, special", a: "ordinary, normal", ex: "It was an ______ rescue, as they saved all the passengers." },
    { u: 11, w: "heroic", d: "Very brave and showing great courage.", s: "brave, courageous", a: "cowardly, weak", ex: "The firefighter made a ______ effort to save the cat from the tree." },
    { u: 11, w: "lance", d: "A long, sharp weapon for thrusting.", s: "spear, weapon", a: "shield, protection", ex: "The knight carried a ______ as he rode his horse into battle." },
    { u: 11, w: "missionary", d: "A person sent to promote a religion in a foreign country.", s: "evangelist, preacher", a: "skeptic, nonbeliever", ex: "The ______ traveled overseas to help the poor." },
    { u: 11, w: "pointless", d: "Having no purpose or meaning.", s: "useless, senseless", a: "useful, meaningful", ex: "Arguing about the weather is completely ______." },
    { u: 11, w: "reflect", d: "To think deeply about something; to bounce back light.", s: "consider, mirror", a: "ignore, absorb", ex: "She took a moment to ______ on her mistakes." },
    { u: 11, w: "site", d: "A location or area.", s: "location, place", a: "entire area, non-place", ex: "This ______ is where the new school will be built." },
    { u: 11, w: "toxic", d: "Poisonous or harmful.", s: "poisonous, deadly", a: "harmless, safe", ex: "Be careful not to spill any of the ______ cleaning chemicals." },

    // UNIT 12
    { u: 12, w: "bristle", d: "A short, stiff hair; to show sudden anger.", s: "hair, spine", a: "smooth skin, calmness", ex: "The boar's coarse ______ felt rough to the touch." },
    { u: 12, w: "circular", d: "Having the shape of a circle.", s: "round, ring-shaped", a: "straight, square", ex: "They sat around the ______ table to play a game." },
    { u: 12, w: "coarse", d: "Rough or harsh in texture.", s: "rough, scratchy", a: "smooth, soft", ex: "The sandpaper felt very ______ against my skin." },
    { u: 12, w: "discard", d: "To throw away or get rid of.", s: "throw away, toss", a: "keep, save", ex: "Please ______ all your trash into the proper bin." },
    { u: 12, w: "extreme", d: "The greatest or farthest point.", s: "intense, maximum", a: "moderate, mild", ex: "Climbing Mount Everest is an ______ challenge." },
    { u: 12, w: "focus", d: "To concentrate attention on something.", s: "concentrate, center", a: "ignore, disperse", ex: "Try to ______ on your book and ignore the noise." },
    { u: 12, w: "grasp", d: "To take hold of something firmly.", s: "grip, hold", a: "release, drop", ex: "She used a strong hand to ______ the rope firmly." },
    { u: 12, w: "inspire", d: "To fill someone with the urge or ability to do something.", s: "motivate, encourage", a: "discourage, bore", ex: "Her story will ______ others to chase their dreams." },
    { u: 12, w: "magnify", d: "To make something look larger than it is.", s: "enlarge, zoom in", a: "shrink, reduce", ex: "We used a lens to ______ the tiny insects." },
    { u: 12, w: "marine", d: "Relating to the sea or ocean.", s: "sea, aquatic", a: "land, terrestrial", ex: "Whales and dolphins are beautiful ______ animals." },
    { u: 12, w: "quake", d: "To shake or tremble.", s: "shake, shiver", a: "stabilize, hold firm", ex: "The old house seemed to ______ during the loud thunderstorm." },
    { u: 12, w: "troublesome", d: "Causing difficulty or annoyance.", s: "annoying, difficult", a: "easy, pleasant", ex: "The constant barking of the dog was quite ______." },

    // UNIT 13
    { u: 13, w: "abstract", d: "Existing only as an idea; not concrete.", s: "theoretical, non-physical", a: "concrete, real", ex: "Happiness is an ______ idea that is hard to describe." },
    { u: 13, w: "ally", d: "A person or country joined with another for a common purpose.", s: "partner, friend", a: "enemy, opponent", ex: "The two nations became close ______ to fight a war." },
    { u: 13, w: "appoint", d: "To choose a person for a job or position.", s: "select, assign", a: "dismiss, remove", ex: "The president will ______ a new judge to the court." },
    { u: 13, w: "attentive", d: "Paying close attention.", s: "observant, watchful", a: "careless, distracted", ex: "She was an ______ listener in class and took good notes." },
    { u: 13, w: "bonus", d: "Something extra given as a reward.", s: "extra, reward", a: "loss, penalty", ex: "The company gave everyone a large ______ at the end of the year." },
    { u: 13, w: "carefree", d: "Without worries; lighthearted.", s: "relaxed, cheerful", a: "worried, serious", ex: "We spent a ______ summer afternoon swimming in the lake." },
    { u: 13, w: "courtesy", d: "Polite behavior; good manners.", s: "politeness, respect", a: "rudeness, disrespect", ex: "She showed great ______ by holding the door open for the elderly man." },
    { u: 13, w: "manufacture", d: "To make something, usually in a factory.", s: "produce, make", a: "destroy, buy", ex: "The factory is able to ______ hundreds of toys each day." },
    { u: 13, w: "mistrust", d: "Lack of trust or confidence.", s: "doubt, suspicion", a: "trust, belief", ex: "The long history of lies caused deep ______ between them." },
    { u: 13, w: "noticeable", d: "Easy to see or observe.", s: "obvious, clear", a: "hidden, invisible", ex: "The difference in their heights was very ______." },
    { u: 13, w: "overthrow", d: "To remove from power; to defeat.", s: "remove, topple", a: "install, support", ex: "The people planned to ______ the cruel king." },
    { u: 13, w: "peculiar", d: "Strange or unusual.", s: "odd, strange", a: "normal, common", ex: "The dog had a ______ habit of chasing its own tail." },

    // UNIT 14
    { u: 14, w: "absolute", d: "Complete, total, or without limits.", s: "total, entire", a: "partial, limited", ex: "You have my ______ permission to use my computer." },
    { u: 14, w: "arena", d: "A place for public events or sports.", s: "stadium, venue", a: "home, private space", ex: "The famous singer will perform in the large city ______." },
    { u: 14, w: "compliment", d: "An expression of praise or admiration.", s: "praise, flattery", a: "insult, criticism", ex: "The teacher gave the student a ______ on her good writing." },
    { u: 14, w: "deliberate", d: "Done on purpose; carefully considered.", s: "intentional, planned", a: "accidental, careless", ex: "The slow movements were careful and ______." },
    { u: 14, w: "dense", d: "Closely packed together; thick.", s: "thick, crowded", a: "sparse, thin", ex: "The forest was so ______ that sunlight could barely reach the ground." },
    { u: 14, w: "dominant", d: "Most important, powerful, or controlling.", s: "main, powerful", a: "minor, weak", ex: "The lion is the ______ animal in the savanna." },
    { u: 14, w: "hazardous", d: "Dangerous or risky.", s: "dangerous, unsafe", a: "safe, secure", ex: "Do not go near the sign that says \"______ materials.\"" },
    { u: 14, w: "huddle", d: "To crowd together closely.", s: "cluster, gather", a: "scatter, spread out", ex: "The sheep began to ______ together for warmth in the snow." },
    { u: 14, w: "necessity", d: "Something that is needed or essential.", s: "requirement, must-have", a: "luxury, extra", ex: "Food and water are a basic ______ for all life." },
    { u: 14, w: "offend", d: "To hurt someone's feelings; to insult.", s: "insult, displease", a: "compliment, please", ex: "I hope I didn't ______ you with my clumsy comment." },
    { u: 14, w: "regain", d: "To get something back.", s: "recover, restore", a: "lose, surrender", ex: "He worked hard to ______ his health after the long illness." },
    { u: 14, w: "thorough", d: "Complete and very careful.", s: "careful, detailed", a: "careless, incomplete", ex: "The detective did a ______ search of the entire house." },

    // UNIT 15
    { u: 15, w: "adopt", d: "To take a child into your family or to take up an idea.", s: "take in, accept", a: "reject, abandon", ex: "The couple decided to ______ a child from the orphanage." },
    { u: 15, w: "agile", d: "Able to move quickly and easily.", s: "nimble, quick", a: "clumsy, stiff", ex: "The mountain goat was very ______ as it climbed the rocks." },
    { u: 15, w: "analyze", d: "To study something closely and carefully.", s: "examine, study", a: "guess, ignore", ex: "The scientist will ______ the soil sample for traces of pollution." },
    { u: 15, w: "assist", d: "To help or aid someone.", s: "help, aid", a: "hinder, block", ex: "The older student agreed to ______ the younger kids with their math homework." },
    { u: 15, w: "babble", d: "To make sounds like a baby; to talk foolishly.", s: "chatter, mumble", a: "speak clearly, be quiet", ex: "The little baby would often ______ when playing with toys." },
    { u: 15, w: "captivity", d: "The state of being held as a prisoner.", s: "imprisonment, confinement", a: "freedom, liberty", ex: "The zoo works to protect animals kept in ______." },
    { u: 15, w: "drab", d: "Dull, boring, and colorless.", s: "dull, uninteresting", a: "bright, colorful", ex: "The walls of the old building were a ______ shade of gray." },
    { u: 15, w: "fatal", d: "Causing death.", s: "deadly, lethal", a: "harmless, safe", ex: "The fall from the cliff proved to be ______." },
    { u: 15, w: "generosity", d: "The quality of being kind and giving.", s: "kindness, giving", a: "selfishness, greed", ex: "Her ______ led her to donate a lot of money to the poor." },
    { u: 15, w: "genuine", d: "Real, true, or sincere.", s: "real, authentic", a: "fake, false", ex: "I could tell by her smile that her happiness was ______." },
    { u: 15, w: "illegal", d: "Against the law.", s: "unlawful, forbidden", a: "legal, lawful", ex: "Driving without a license is completely ______." },
    { u: 15, w: "merit", d: "Deserving of reward or praise.", s: "worth, value", a: "fault, flaw", ex: "The judges decided the painting had great artistic ______." },

    // UNIT 16
    { u: 16, w: "adorn", d: "To decorate or make beautiful.", s: "decorate, embellish", a: "strip, damage", ex: "She used flowers and lights to ______ the party room." },
    { u: 16, w: "appropriate", d: "Right for the purpose; suitable.", s: "suitable, proper", a: "inappropriate, wrong", ex: "That outfit is not ______ for a formal wedding ceremony." },
    { u: 16, w: "assemble", d: "To bring or put together.", s: "gather, connect", a: "scatter, disassemble", ex: "We need to ______ all the parts to build the new toy." },
    { u: 16, w: "colossal", d: "Extremely large or huge.", s: "huge, gigantic", a: "tiny, small", ex: "The new skyscraper was a ______ building in the city skyline." },
    { u: 16, w: "effective", d: "Producing the desired result.", s: "successful, potent", a: "useless, weak", ex: "This medicine is very ______ at curing a headache." },
    { u: 16, w: "frail", d: "Weak and easily damaged.", s: "delicate, weak", a: "strong, sturdy", ex: "The small bird seemed so ______ in the cold winter air." },
    { u: 16, w: "hostage", d: "A person held prisoner until demands are met.", s: "captive, prisoner", a: "guard, captor", ex: "The criminals held the bank manager as a ______." },
    { u: 16, w: "landslide", d: "A sudden, rapid movement of earth and rocks down a slope.", s: "mudslide, collapse", a: "stability, firmness", ex: "Heavy rain caused a ______ that blocked the mountain road." },
    { u: 16, w: "rampage", d: "To rush around in a wild, destructive way.", s: "storm, rush", a: "calm, be gentle", ex: "The escaped tiger went on a destructive ______ through the jungle." },
    { u: 16, w: "scamper", d: "To run or move quickly and playfully.", s: "dash, hurry", a: "stroll, walk slowly", ex: "The little squirrel began to ______ up the oak tree." },
    { u: 16, w: "symptom", d: "A sign or indication of a disease.", s: "sign, indication", a: "cause, cure", ex: "A fever can be a ______ of the flu." },
    { u: 16, w: "warrant", d: "A written order that gives authority; to justify.", s: "authorization, justify", a: "denial, ignore", ex: "The police needed a ______ to search the house." },

    // UNIT 17
    { u: 17, w: "approximate", d: "Close to the actual amount; nearly exact.", s: "estimate, near", a: "exact, precise", ex: "I can only give you an ______ guess of the travel time." },
    { u: 17, w: "construct", d: "To build or put together.", s: "build, make", a: "demolish, destroy", ex: "The workers plan to ______ a new bridge over the river." },
    { u: 17, w: "crude", d: "Not carefully made; rough or simple.", s: "raw, simple", a: "refined, polished", ex: "The settlers lived in a ______ cabin made of logs." },
    { u: 17, w: "decline", d: "To refuse to accept; to gradually fall.", s: "refuse, drop", a: "accept, increase", ex: "The price of gasoline began to ______ after the holidays." },
    { u: 17, w: "distinct", d: "Clearly different; easily seen.", s: "clear, separate", a: "vague, similar", ex: "The parrot has two ______ colors on its wings." },
    { u: 17, w: "evident", d: "Easy to see or understand; obvious.", s: "obvious, clear", a: "hidden, unclear", ex: "It was ______ from her smile that she was very happy." },
    { u: 17, w: "impulse", d: "A sudden, strong desire to act.", s: "urge, whim", a: "plan, thought", ex: "I bought the candy bar on a sudden ______ at the checkout." },
    { u: 17, w: "interpret", d: "To explain the meaning of something.", s: "explain, translate", a: "confuse, misunderstand", ex: "The travel guide was there to ______ the ancient writings." },
    { u: 17, w: "orient", d: "To adjust to a situation or position.", s: "align, adapt", a: "confuse, disorient", ex: "The map helped us ______ ourselves in the new city." },
    { u: 17, w: "sector", d: "A part or division of an area.", s: "part, zone", a: "whole, entirety", ex: "The police searched the northeast ______ of the park." },
    { u: 17, w: "submit", d: "To give in to another's power; to present for review.", s: "yield, hand in", a: "resist, withdraw", ex: "You must ______ your final paper by the end of the day." },
    { u: 17, w: "zest", d: "Great enthusiasm or excitement.", s: "enthusiasm, energy", a: "dullness, boredom", ex: "She went on the trip with great ______ and excitement." },

 
        // UNIT 18
        { u: 18, w: "depress", d: "To make sad or lower in spirits.", s: "sadden, discourage", a: "cheer, elevate", ex: "The gray, rainy weather began to ______ my mood." },
        { u: 18, w: "dismal", d: "Causing gloom or sadness.", s: "gloomy, sad", a: "cheerful, joyful", ex: "The team played a ______ game and lost by a large score." },
        { u: 18, w: "dispose", d: "To get rid of something.", s: "discard, dump", a: "keep, save", ex: "Please ______ of your garbage in the proper bin." },
        { u: 18, w: "exaggerate", d: "To describe something as larger or greater than it really is.", s: "overstate, inflate", a: "minimize, understate", ex: "He tends to ______ his stories to make them sound more exciting." },
        { u: 18, w: "indifferent", d: "Not caring or interested.", s: "unconcerned, uncaring", a: "interested, concerned", ex: "I was ______ as to whether we watched a movie or read a book." },
        { u: 18, w: "jubilant", d: "Feeling or expressing great joy.", s: "joyful, thrilled", a: "sad, depressed", ex: "The crowd was ______ when their team won the championship." },
        { u: 18, w: "manual", d: "Done by hand; a handbook.", s: "hand-operated, guide", a: "automatic, digital", ex: "Turning the large crank required ______ effort." },
        { u: 18, w: "originate", d: "To come from or begin somewhere.", s: "begin, start", a: "end, finish", ex: "The river is said to ______ high up in the mountains." },
        { u: 18, w: "recognition", d: "Acknowledgment or appreciation.", s: "praise, credit", a: "disregard, neglect", ex: "The brave soldier received a medal in ______ of his service." },
        { u: 18, w: "tribute", d: "Something given or done to show respect.", s: "praise, honor", a: "insult, criticism", ex: "We held a short ______ to honor the founder of the school." }
    ];

        // --- 2. ICONS ---
        const ICONS = {
            arrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`,
            arrowRight: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>`,
            check: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>`,
            x: `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`,
            refresh: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>`,
            sprout: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 20h10"/><path d="M10 20c5.5-2.5.8-6.4 3-10"/><path d="M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z"/><path d="M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z"/></svg>`,
            book: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>`,
            hammer: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m15 12-8.5 8.5c-.83.83-2.17.83-3 0 0 0 0 0 0 0a2.12 2.12 0 0 1 0-3L12 9"/><path d="M17.64 15 22 10.64"/><path d="m20.91 11.7-1.25-1.25c-.6-.6-.93-1.4-.93-2.25V7.86c0-.55-.45-1-1-1H14.14c-.83 0-1.64.34-2.25.92L9.64 10"/></svg>`,
            leaf: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>`,
            layers: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></svg>`,
            alignLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="21" x2="3" y1="6" y2="6"/><line x1="15" x2="3" y1="12" y2="12"/><line x1="17" x2="3" y1="18" y2="18"/></svg>`,
            split: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 3h5v5"/><path d="M8 3H3v5"/><path d="M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3"/><path d="m15 9 6-6"/></svg>`,
            message: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>`,
            sun: `<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="currentColor" stroke="none"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`,
            cloud: `<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M17.5 19c0-1.7-1.3-3-3-3h-11c-1.7 0-3 1.3-3 3s1.3 3 3 3h11c1.7 0 3-1.3 3-3z"/><path d="M17.5 19a6 6 0 0 0-5-11.8A5.5 5.5 0 0 0 0 13"/></svg>`
        };

        // --- 3. STATE MANAGEMENT ---
        const State = {
            view: 'selection',
            activeUnits: [],
            pool: [],      
            queue: [],     
            completedGames: new Set(),
            
            // New Persisted Game Data
            gameQueues: {}, // stores [item1, item2...] for each game
            gameTotals: {}, // stores initial count to calculate percentage
            
            // Game specific
            tempData: null, 
            feedback: null 
        };

        const GAMES_ORDER = ['sketchbook', 'roots', 'order', 'story', 'workshop', 'garden', 'quiz'];
        const GAME_INFO = {
            sketchbook: { title: 'Sketchbook', desc: 'Study cards', icon: ICONS.book, color: 'blue' },
            roots: { title: 'Roots', desc: 'Synonyms', icon: ICONS.split, color: 'purple' },
            order: { title: 'Order', desc: 'Alphabetize', icon: ICONS.alignLeft, color: 'blue' },
            story: { title: 'Story Stones', desc: 'Complete it', icon: ICONS.message, color: 'amber' },
            workshop: { title: 'Workshop', desc: 'Build words', icon: ICONS.hammer, color: 'amber' },
            garden: { title: 'Garden', desc: 'Match seeds', icon: ICONS.leaf, color: 'green' },
            quiz: { title: 'Pebble Paths', desc: 'Find meaning', icon: ICONS.layers, color: 'slate' }
        };

        const App = document.getElementById('app');
        const UnitDisplay = document.getElementById('unit-count-display');

        // Helper: Shuffle Array
        function shuffle(array) {
            let currentIndex = array.length, randomIndex;
            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
            }
            return array;
        }

        // --- 4. NAVIGATION & INIT ---

        function initGame(viewId) {
            State.view = viewId;
            State.tempData = null;
            State.feedback = null;

            // Initialize or Restore Game Queue
            if (!State.gameQueues[viewId]) {
                let newQueue = [];
                if (viewId === 'roots') {
                    newQueue = shuffle(State.pool.filter(i => (i.s && i.s !== 'void' && i.s !== '-') || (i.a && i.a !== 'void' && i.a !== '-')));
                } else {
                    newQueue = shuffle([...State.pool]);
                }
                State.gameQueues[viewId] = newQueue;
                State.gameTotals[viewId] = newQueue.length;
            }
            
            State.queue = State.gameQueues[viewId]; // Reference the persistent queue
            render();
        }

        function checkVictory() {
            if (State.queue.length === 0) {
                if (State.view !== 'victory') State.completedGames.add(State.view);
                State.view = 'victory';
                render();
                return true;
            }
            return false;
        }
        
        // Helper to sync queue state if array is replaced (for games that slice/filter)
        function updatePersistentQueue() {
            if (State.view !== 'victory' && State.view !== 'menu' && State.view !== 'selection') {
                State.gameQueues[State.view] = State.queue;
            }
        }

        function render() {
            UnitDisplay.innerText = State.activeUnits.length;
            App.innerHTML = ''; 

            switch(State.view) {
                case 'selection': renderSelection(); break;
                case 'menu': renderMenu(); break;
                case 'victory': renderVictory(); break;
                case 'grand_victory': renderGrandVictory(); break;
                
                case 'sketchbook': renderSketchbook(); break;
                case 'workshop': renderWorkshop(); break;
                case 'quiz': renderQuiz(); break;
                case 'garden': renderGarden(); break;
                case 'order': renderOrder(); break;
                case 'roots': renderRoots(); break;
                case 'story': renderStory(); break;
            }
        }

        // --- 5. SCREENS ---

        function renderSelection() {
            const units = [...new Set(RAW_DATA.map(i => i.u))].sort((a,b) => 
                String(a).localeCompare(String(b), undefined, {numeric: true})
            );

            const container = document.createElement('div');
            container.className = "flex flex-col items-center justify-center min-h-[60vh] w-full max-w-2xl mx-auto animate-fadeIn";
            
            container.innerHTML = `
                <div class="text-center mb-8">
                    <h1 class="text-4xl md:text-5xl font-serif text-stone-800 mb-2">Vocabulary Garden</h1>
                    <p class="text-stone-500 italic">Open the gate to begin.</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 w-full mb-8">
                    <div class="flex justify-between items-center mb-4 pb-4 border-b border-stone-100">
                        <h2 class="text-lg font-bold text-stone-700">Select Collections</h2>
                        <button id="btn-toggle-all" class="text-sm text-green-600 font-medium hover:text-green-800">
                            ${State.activeUnits.length === units.length ? "Deselect All" : "Select All"}
                        </button>
                    </div>
                    <div id="unit-list" class="grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar"></div>
                </div>
                <button id="btn-start" class="px-8 py-3 rounded-full font-bold text-lg shadow-md transition-all flex items-center gap-2 ${State.activeUnits.length > 0 ? 'bg-green-700 text-white hover:bg-green-800 hover:scale-105' : 'bg-stone-200 text-stone-400 cursor-not-allowed'}">
                    Enter Garden ${ICONS.arrowRight}
                </button>
            `;

            const list = container.querySelector('#unit-list');
            units.forEach(u => {
                const isSelected = State.activeUnits.includes(u);
                const btn = document.createElement('button');
                btn.className = `flex items-center p-3 rounded-lg text-left transition-all border-2 w-full ${isSelected ? 'bg-green-50 border-green-500 text-green-900' : 'bg-stone-50 border-transparent hover:bg-stone-100 text-stone-600'}`;
                const unitLabel = typeof u === 'string' && u.includes(':') ? u.split(':')[0] : `Unit ${u}`;
                
                btn.innerHTML = `<div class="w-5 h-5 rounded border mr-3 flex items-center justify-center transition-colors ${isSelected ? 'bg-green-500 border-green-500' : 'border-stone-300 bg-white'}">${isSelected ? `<span class="text-white">${ICONS.check}</span>` : ''}</div><span class="text-sm font-medium truncate">${u}</span>`;
                btn.onclick = () => {
                    if (isSelected) State.activeUnits = State.activeUnits.filter(x => x !== u);
                    else State.activeUnits.push(u);
                    render();
                };
                list.appendChild(btn);
            });

            container.querySelector('#btn-start').onclick = () => {
                if (State.activeUnits.length === 0) return;
                State.pool = RAW_DATA.filter(item => State.activeUnits.includes(item.u));
                // Clear persistence on new start
                State.completedGames.clear();
                State.gameQueues = {};
                State.gameTotals = {};
                
                State.view = 'menu';
                render();
            };
            container.querySelector('#btn-toggle-all').onclick = () => {
                if (State.activeUnits.length === units.length) State.activeUnits = [];
                else State.activeUnits = [...units];
                render();
            };
            App.appendChild(container);
        }

        function renderMenu() {
            if (State.completedGames.size === GAMES_ORDER.length) {
                renderGrandVictory();
                return;
            }

            const suggestedGame = GAMES_ORDER.find(id => !State.completedGames.has(id));
            const completionPct = Math.round((State.completedGames.size / GAMES_ORDER.length) * 100);
            const gardenLevel = Math.floor((completionPct / 100) * 5);

            const div = document.createElement('div');
            div.className = "flex flex-col items-center w-full max-w-5xl mx-auto animate-fadeIn";
            div.innerHTML = `
                <div class="w-full flex justify-start mb-2"><button id="btn-back-units" class="text-stone-400 hover:text-stone-600 text-sm flex items-center gap-1">${ICONS.arrowLeft} Select different units</button></div>
                <header class="text-center mb-6 w-full"><h1 class="text-4xl font-serif text-stone-800 mb-1">The Garden</h1><p class="text-stone-500 italic text-sm">Choose a path to explore.</p></header>
                
                <div class="w-full bg-gradient-to-b from-sky-50 to-white border border-stone-200 rounded-3xl p-6 mb-8 shadow-sm relative overflow-hidden h-40">
                    <div class="absolute top-4 right-4 text-yellow-400 animate-pulse-slow">${ICONS.sun}</div><div class="absolute top-6 left-10 text-sky-100">${ICONS.cloud}</div>
                    <div class="flex flex-col items-center justify-end h-full relative z-10 pb-2">
                        <div class="flex items-end gap-3 mb-2" id="plant-container"></div>
                        <div class="w-64 h-3 bg-stone-200 rounded-full overflow-hidden">
                            <div class="h-full bg-green-500 transition-all duration-500" style="width: ${completionPct}%"></div>
                        </div>
                        <p class="mt-2 text-stone-600 font-bold text-xs">${State.completedGames.size} of ${GAMES_ORDER.length} Activities Complete</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 w-full" id="menu-grid"></div>
            `;

            const plantCont = div.querySelector('#plant-container');
            for(let i=0; i<5; i++) {
                const p = document.createElement('div');
                const isGrown = i < gardenLevel;
                p.className = `transition-all duration-1000 ${isGrown ? 'opacity-100 translate-y-0 text-green-600' : 'opacity-20 translate-y-8 scale-50 text-green-300'}`;
                p.innerHTML = ICONS.sprout;
                plantCont.appendChild(p);
            }

            const grid = div.querySelector('#menu-grid');
            GAMES_ORDER.forEach(id => {
                const info = GAME_INFO[id];
                const isComplete = State.completedGames.has(id);
                const isSuggested = id === suggestedGame;
                
                // Calculate mini progress
                let pct = 0;
                if (State.gameQueues[id] && State.gameTotals[id] > 0) {
                    const remaining = State.gameQueues[id].length;
                    const total = State.gameTotals[id];
                    pct = Math.round(((total - remaining) / total) * 100);
                } else if (isComplete) {
                    pct = 100;
                }

                const btn = document.createElement('button');
                let classes = `group relative bg-white rounded-2xl p-4 shadow-sm border-2 transition-all text-left flex flex-col h-36 justify-between overflow-hidden`;
                
                if (isComplete) {
                    classes += ` border-green-200 bg-green-50/30 opacity-80`; 
                } else if (isSuggested) {
                    classes += ` border-amber-400 ring-4 ring-amber-100 ring-offset-2 animate-glow shadow-md transform scale-105 z-10`; 
                } else {
                    classes += ` border-stone-100 hover:border-${info.color}-200 hover:shadow-md`;
                }

                btn.className = classes;
                btn.innerHTML = `
                    <div class="absolute -right-4 -top-4 bg-${info.color}-50 w-20 h-20 rounded-full transition-transform group-hover:scale-150"></div>
                    <div class="z-10 bg-${info.color}-100 w-10 h-10 rounded-lg flex items-center justify-center text-${info.color}-700 mb-2">
                        ${isComplete ? ICONS.check : info.icon}
                    </div>
                    <div class="z-10 w-full">
                        <h3 class="text-base font-bold text-stone-800 mb-0 leading-tight flex items-center gap-2">
                            ${info.title}
                            ${isSuggested ? '<span class="text-[10px] bg-amber-200 text-amber-800 px-1.5 py-0.5 rounded-full uppercase tracking-wide">Next</span>' : ''}
                        </h3>
                        <p class="text-xs text-stone-500 mb-2">${isComplete ? 'Complete!' : info.desc}</p>
                        
                        <!-- Mini Progress Bar -->
                        <div class="w-full h-1.5 bg-stone-100 rounded-full overflow-hidden">
                            <div class="h-full bg-${isComplete ? 'green' : info.color}-500 transition-all duration-500" style="width: ${pct}%"></div>
                        </div>
                    </div>
                `;
                btn.onclick = () => initGame(id);
                grid.appendChild(btn);
            });

            div.querySelector('#btn-back-units').onclick = () => { State.view = 'selection'; render(); };
            App.appendChild(div);
        }

        function renderVictory() {
            const div = document.createElement('div');
            div.className = "flex flex-col items-center justify-center text-center p-8 animate-fadeIn max-w-md mx-auto";
            div.innerHTML = `
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-6 animate-pulse-slow">
                    ${ICONS.sprout}
                </div>
                <h2 class="text-3xl font-serif text-stone-800 mb-2">Activity Complete!</h2>
                <p class="text-stone-500 mb-8">You have tended this part of the garden. Ready for the next step?</p>
                <button id="back-btn" class="px-8 py-3 bg-green-700 text-white rounded-full font-bold shadow-md hover:bg-green-800 transition-all flex items-center gap-2">
                    ${ICONS.arrowLeft} Return to Map
                </button>
            `;
            div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
            App.appendChild(div);
        }

        function renderGrandVictory() {
            const div = document.createElement('div');
            div.className = "flex flex-col items-center justify-center text-center p-8 animate-fadeIn max-w-2xl mx-auto min-h-[50vh]";
            div.innerHTML = `
                <div class="relative w-32 h-32 mb-8">
                    <div class="absolute inset-0 bg-yellow-100 rounded-full animate-pulse-slow"></div>
                    <div class="absolute inset-0 flex items-center justify-center text-yellow-500">
                        ${ICONS.sun}
                    </div>
                    <div class="absolute -bottom-2 -right-2 bg-green-100 rounded-full p-2 text-green-600 border-4 border-white">
                        ${ICONS.leaf}
                    </div>
                </div>
                
                <h1 class="text-4xl md:text-5xl font-serif text-stone-800 mb-4">Master Gardener!</h1>
                <p class="text-xl text-stone-600 mb-8 leading-relaxed max-w-lg">
                    You have completed all activities for these units. The garden is now in full bloom thanks to your hard work!
                </p>
                
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="btn-restart-activities" class="px-8 py-3 bg-stone-100 text-stone-600 rounded-full font-bold hover:bg-stone-200 transition-all">
                        Do Activities Again
                    </button>
                    <button id="btn-new-units" class="px-8 py-3 bg-green-700 text-white rounded-full font-bold shadow-lg hover:bg-green-800 hover:scale-105 transition-all flex items-center justify-center gap-2">
                        Select New Units ${ICONS.arrowRight}
                    </button>
                </div>
            `;
            
            div.querySelector('#btn-restart-activities').onclick = () => { 
                State.completedGames.clear(); 
                State.gameQueues = {}; // clear progress
                State.view = 'menu'; 
                render(); 
            };
            
            div.querySelector('#btn-new-units').onclick = () => { 
                State.view = 'selection'; 
                render(); 
            };
            
            App.appendChild(div);
        }

        // --- 6. GAMES ---

        // A. Sketchbook
        function renderSketchbook() {
            if (State.queue.length === 0) { checkVictory(); return; }
            const item = State.queue[0];
            const isFlipped = State.feedback === true;
            const unitLabel = String(item.u).includes(':') ? String(item.u).split(':')[0] : `Unit ${item.u}`;

            const div = document.createElement('div');
            div.className = "flex flex-col items-center justify-center w-full animate-fadeIn";
            div.innerHTML = `
                <div class="flex items-center justify-between w-full max-w-md mb-6"><button id="back-btn" class="flex items-center text-stone-600 hover:text-stone-800 transition-colors">${ICONS.arrowLeft} Garden</button><span class="text-stone-500 font-serif italic">${State.queue.length} seeds left</span></div>
                <div id="card-container" class="cursor-pointer group perspective-1000 w-full max-w-md h-96 relative ${isFlipped ? 'flipped' : ''}">
                    <div class="card-inner relative w-full h-full transform-style-3d">
                        <div class="absolute w-full h-full backface-hidden bg-white rounded-xl shadow-lg border-2 border-stone-200 flex flex-col items-center justify-center p-8 bg-paper-pattern">
                            <span class="text-stone-400 text-xs absolute top-4 right-4 uppercase tracking-wider truncate max-w-[150px]">${unitLabel}</span><h2 class="text-4xl text-stone-800 font-serif font-medium tracking-wide text-center">${item.w}</h2><div class="mt-8 text-stone-400 text-sm flex items-center gap-2">${ICONS.refresh} Tap to reveal</div>
                        </div>
                        <div class="absolute w-full h-full backface-hidden bg-stone-50 rounded-xl shadow-lg border-2 border-stone-300 flex flex-col items-center justify-center p-8 rotate-y-180 bg-paper-pattern">
                            <span class="text-stone-400 text-sm absolute top-4 right-4">Definition</span><p class="text-xl text-stone-700 text-center font-medium leading-relaxed mb-6">"${item.d}"</p>
                            <div class="w-full grid grid-cols-2 gap-4 mt-4 border-t-2 border-dashed border-stone-200 pt-4"><div class="text-center"><span class="block text-xs uppercase tracking-widest text-stone-400 mb-1">Synonym</span><span class="text-stone-600 font-serif italic">${item.s || '-'}</span></div><div class="text-center"><span class="block text-xs uppercase tracking-widest text-stone-400 mb-1">Antonym</span><span class="text-stone-600 font-serif italic">${item.a || '-'}</span></div></div>
                        </div>
                    </div>
                </div>
                <div class="flex gap-4 mt-8 w-full max-w-md">
                    <button id="btn-again" class="flex-1 py-3 px-6 rounded-lg border-2 border-stone-300 text-stone-500 font-bold hover:bg-stone-100 transition-colors">Shuffle</button>
                    <button id="btn-gotit" class="flex-1 py-3 px-6 rounded-lg bg-green-700/90 text-white font-bold shadow-md hover:bg-green-800 hover:shadow-lg transition-all flex items-center justify-center gap-2">${ICONS.check} Got it!</button>
                </div>
            `;
            div.querySelector('#card-container').onclick = () => { State.feedback = !State.feedback; render(); };
            div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
            div.querySelector('#btn-again').onclick = (e) => { 
                e.stopPropagation(); 
                State.feedback = false; 
                State.queue.push(State.queue.shift()); // Rotate
                // No updatePersistentQueue needed as content same, just order
                render(); 
            };
            div.querySelector('#btn-gotit').onclick = (e) => { 
                e.stopPropagation(); 
                State.feedback = false; 
                State.queue.shift(); // Remove
                updatePersistentQueue(); // SAVE PROGRESS
                if(!checkVictory()) render(); 
            };
            App.appendChild(div);
        }

        // B. Workshop
        function renderWorkshop() {
            if (checkVictory()) return;
            const item = State.queue[0];

            if (!State.tempData || State.tempData.word !== item.w) {
                const w = item.w;
                const letters = w.split('').map((l, i) => ({ val: l, id: i }));
                for (let i = letters.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [letters[i], letters[j]] = [letters[j], letters[i]]; }
                State.tempData = { word: w, shuffled: letters, placed: Array(w.length).fill(null) };
                State.feedback = null;
            }

            const div = document.createElement('div');
            div.className = "flex flex-col items-center justify-start w-full animate-fadeIn";
            div.innerHTML = `
                <div class="flex items-center justify-between w-full max-w-lg mb-8"><button id="back-btn" class="flex items-center text-stone-600 hover:text-stone-800">${ICONS.arrowLeft} Garden</button><span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold tracking-wider">WORKSHOP</span></div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 w-full max-w-lg text-center mb-8"><p class="text-xl text-stone-800 font-medium leading-relaxed">"${item.d}"</p></div>
                <div class="flex flex-wrap justify-center gap-2 mb-10 ${State.feedback === false ? 'animate-shake' : ''}" id="slots-area"></div>
                <div class="flex flex-wrap justify-center gap-2 max-w-lg" id="tiles-area"></div>
                ${State.feedback === true ? `<div class="fixed bottom-10 bg-green-600 text-white px-6 py-2 rounded-full shadow-lg flex items-center gap-2 animate-bounce">${ICONS.check} Built!</div>` : ''}
            `;

            const slotsArea = div.querySelector('#slots-area');
            State.tempData.placed.forEach((l, i) => {
                const btn = document.createElement('button');
                btn.className = `w-10 h-12 rounded-lg flex items-center justify-center text-xl font-bold shadow-inner border-2 transition-all ${l ? (State.feedback===true ? 'bg-green-100 border-green-300 text-green-700' : 'bg-stone-100 border-stone-300 text-stone-800') : 'bg-stone-50 border-stone-200 border-dashed'}`;
                btn.innerText = l ? l.val : '';
                btn.onclick = () => { if (State.feedback === true || !l) return; State.tempData.shuffled.push(l); State.tempData.placed[i] = null; render(); };
                slotsArea.appendChild(btn);
            });

            const tilesArea = div.querySelector('#tiles-area');
            State.tempData.shuffled.forEach((l) => {
                const btn = document.createElement('button');
                btn.className = "w-10 h-12 bg-amber-200 rounded-lg shadow-sm border-t border-amber-100 flex items-center justify-center text-xl font-bold text-amber-900 active:translate-y-1 transition-transform";
                btn.innerText = l.val;
                btn.onclick = () => {
                    if (State.feedback === true) return;
                    const firstEmpty = State.tempData.placed.indexOf(null);
                    if (firstEmpty !== -1) {
                        State.tempData.placed[firstEmpty] = l;
                        State.tempData.shuffled = State.tempData.shuffled.filter(x => x.id !== l.id);
                        if (State.tempData.placed.indexOf(null) === -1) {
                            if (State.tempData.placed.map(x => x.val).join('') === item.w) {
                                State.feedback = true; 
                                setTimeout(() => { 
                                    State.queue.shift(); 
                                    updatePersistentQueue(); // SAVE PROGRESS
                                    State.tempData = null; 
                                    checkVictory() || render(); 
                                }, 1500);
                            } else { State.feedback = false; setTimeout(() => { State.feedback = null; render(); }, 1000); }
                        }
                        render();
                    }
                };
                tilesArea.appendChild(btn);
            });

            div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
            App.appendChild(div);
        }

        // C. Quiz
        function renderQuiz() {
            if (checkVictory()) return;
            const target = State.queue[0];

            if (!State.tempData || State.tempData.word !== target.w) {
                const distractors = State.pool.filter(i => i.w !== target.w).sort(() => 0.5 - Math.random()).slice(0, 3);
                const opts = [...distractors, target].sort(() => 0.5 - Math.random());
                State.tempData = { word: target.w, options: opts };
                State.feedback = null;
            }

            const div = document.createElement('div');
            div.className = "flex flex-col items-center justify-start w-full animate-fadeIn";
            div.innerHTML = `
                <div class="flex items-center justify-between w-full max-w-2xl mb-8"><button id="back-btn" class="flex items-center text-stone-600 hover:text-stone-800">${ICONS.arrowLeft} Garden</button><span class="bg-slate-100 text-slate-800 px-3 py-1 rounded-full text-xs font-bold tracking-wider">PEBBLE SORTING</span></div>
                <div class="text-center mb-8"><span class="text-stone-400 text-sm uppercase tracking-widest">Find the meaning of</span><h2 class="text-4xl text-stone-800 font-serif font-bold mt-2">${target.w}</h2></div>
                <div class="grid grid-cols-1 gap-4 w-full max-w-2xl" id="opts-container"></div>
            `;

            const optsContainer = div.querySelector('#opts-container');
            State.tempData.options.forEach(opt => {
                const btn = document.createElement('button');
                const isCorrect = opt.w === target.w;
                let cls = "bg-white border-stone-200 hover:bg-slate-50";
                
                if (State.feedback) {
                    if (State.feedback.clicked === opt) cls = isCorrect ? "bg-green-100 border-green-500 text-green-800" : "bg-red-50 border-red-300 text-red-800 animate-shake";
                    else if (isCorrect && State.feedback.clicked !== opt) cls = "bg-green-50 border-green-300 opacity-70";
                }

                btn.className = `p-5 rounded-2xl border-2 shadow-sm text-left transition-all flex items-start gap-4 ${cls}`;
                btn.innerHTML = `<span class="text-lg font-medium leading-snug">${opt.d}</span>`;
                btn.onclick = () => {
                    if (State.feedback) return;
                    State.feedback = { clicked: opt };
                    render();
                    if (isCorrect) {
                        setTimeout(() => { 
                            State.queue.shift(); 
                            updatePersistentQueue(); // SAVE PROGRESS
                            State.tempData = null; 
                            checkVictory() || render(); 
                        }, 1500);
                    } else { setTimeout(() => { State.feedback = null; render(); }, 1500); }
                };
                optsContainer.appendChild(btn);
            });
            div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
            App.appendChild(div);
        }

        // D. Garden
        function renderGarden() {
            if (checkVictory()) return;
            
            // Chunking: Take up to 3 from queue
            if (!State.tempData || !State.tempData.seeds || State.tempData.seeds.length === 0) {
                 const round = State.queue.slice(0, 3);
                 State.tempData = { seeds: round, matched: [], selectedSeed: null };
            }

            const div = document.createElement('div');
            div.className = "flex flex-col w-full p-4 animate-fadeIn";
            div.innerHTML = `
                <div class="flex items-center justify-between w-full mb-6"><button id="back-btn" class="flex items-center text-stone-600 hover:text-stone-800">${ICONS.arrowLeft} Garden</button><div class="flex items-center gap-2 text-green-700">${ICONS.sprout} <span class="font-bold">Planting Season</span></div></div>
                <div class="flex-1 flex flex-col md:flex-row gap-8 items-center justify-center max-w-5xl mx-auto w-full">
                    <div class="flex-1 w-full space-y-4" id="col-seeds"><h3 class="text-center text-stone-400 text-sm uppercase tracking-widest mb-2">Seeds</h3></div>
                    <div class="flex-1 w-full space-y-4" id="col-soil"><h3 class="text-center text-stone-400 text-sm uppercase tracking-widest mb-2">Soil</h3></div>
                </div>
            `;

            const seedCol = div.querySelector('#col-seeds');
            State.tempData.seeds.forEach(item => {
                const isMatched = State.tempData.matched.includes(item.w);
                const isSelected = State.tempData.selectedSeed === item.w;
                const btn = document.createElement('button');
                btn.className = `w-full p-4 rounded-xl border-2 transition-all relative overflow-hidden text-left ${isMatched ? 'bg-green-50 border-green-200 opacity-50' : isSelected ? 'bg-amber-100 border-amber-400 scale-105 shadow-md' : 'bg-white border-stone-200 hover:border-amber-300'}`;
                btn.innerHTML = `<span class="text-lg font-bold text-stone-800">${item.w}</span>`;
                btn.disabled = isMatched;
                btn.onclick = () => { State.tempData.selectedSeed = (State.tempData.selectedSeed === item.w) ? null : item.w; render(); };
                seedCol.appendChild(btn);
            });

            const soilCol = div.querySelector('#col-soil');
            [...State.tempData.seeds].sort((a,b) => a.w.localeCompare(b.w)).forEach(item => {
                const isMatched = State.tempData.matched.includes(item.w);
                const btn = document.createElement('button');
                btn.className = `w-full p-4 rounded-xl border-2 transition-all text-left min-h-[80px] ${isMatched ? 'bg-green-100 border-green-300' : State.tempData.selectedSeed ? 'bg-stone-50 border-stone-300 border-dashed hover:bg-green-50' : 'bg-stone-50 border-stone-200'}`;
                btn.innerHTML = isMatched ? `<div class="flex items-center justify-center gap-2 text-green-800 font-bold">${ICONS.leaf} Planted!</div>` : `<span class="text-stone-600 text-sm">${item.d}</span>`;
                btn.disabled = isMatched;
                btn.onclick = () => {
                    if (State.tempData.selectedSeed === item.w) {
                        State.tempData.matched.push(item.w); State.tempData.selectedSeed = null; 
                        if (State.tempData.matched.length === State.tempData.seeds.length) {
                             // Remove these 3 from queue
                             State.queue = State.queue.slice(State.tempData.seeds.length);
                             updatePersistentQueue(); // SAVE PROGRESS
                             setTimeout(() => { State.tempData = null; checkVictory() || render(); }, 1500);
                        } else render();
                    } else { State.tempData.selectedSeed = null; render(); }
                };
                soilCol.appendChild(btn);
            });
            div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
            App.appendChild(div);
        }

        // E. Order
        function renderOrder() {
             if (checkVictory()) return;
             
             // Take up to 5
             if (!State.tempData) {
                 if (State.queue.length < 2) {
                     State.queue = []; checkVictory(); return;
                 }
                const round = State.queue.slice(0, 5);
                const correctOrder = [...round].sort((a,b) => a.w.localeCompare(b.w));
                State.tempData = { items: round, correctOrder: correctOrder, foundCount: 0, error: false };
             }

             const div = document.createElement('div');
             div.className = "flex flex-col items-center h-full w-full p-4 animate-fadeIn";
             div.innerHTML = `
                <div class="flex items-center justify-between w-full max-w-lg mb-8"><button id="back-btn" class="flex items-center text-stone-600 hover:text-stone-800">${ICONS.arrowLeft} Garden</button><span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-xs font-bold tracking-wider">ORDER</span></div>
                <p class="text-stone-500 italic mb-6">Select the words in alphabetical order.</p>
                <div class="w-full max-w-lg bg-stone-100 rounded-xl p-4 min-h-[80px] flex flex-wrap gap-2 mb-8 border-b-4 border-stone-200 shadow-inner" id="shelf"></div>
                <div class="flex flex-wrap justify-center gap-4 max-w-lg ${State.tempData.error ? 'animate-shake' : ''}" id="pool"></div>
             `;

             const shelf = div.querySelector('#shelf');
             for(let i=0; i<State.tempData.foundCount; i++) {
                 const badge = document.createElement('div');
                 badge.className = "px-4 py-2 bg-green-600 text-white rounded-lg shadow-sm font-bold";
                 badge.innerText = State.tempData.correctOrder[i].w;
                 shelf.appendChild(badge);
             }

             const poolDiv = div.querySelector('#pool');
             State.tempData.items.forEach(item => {
                 const correctIndex = State.tempData.correctOrder.indexOf(item);
                 if (correctIndex < State.tempData.foundCount) return;

                 const btn = document.createElement('button');
                 btn.className = "px-6 py-3 bg-white border-2 border-stone-200 rounded-xl shadow-sm text-stone-700 font-bold text-lg hover:border-blue-300 hover:-translate-y-1 transition-all";
                 btn.innerText = item.w;
                 btn.onclick = () => {
                     const nextCorrect = State.tempData.correctOrder[State.tempData.foundCount];
                     if (item.w === nextCorrect.w) {
                         State.tempData.foundCount++;
                         if (State.tempData.foundCount === State.tempData.items.length) {
                             // Remove played from queue
                             State.queue = State.queue.slice(State.tempData.items.length);
                             updatePersistentQueue(); // SAVE PROGRESS
                             setTimeout(() => { State.tempData = null; checkVictory() || render(); }, 1500);
                         }
                         render();
                     } else { State.tempData.error = true; render(); setTimeout(() => { State.tempData.error = false; render(); }, 500); }
                 };
                 poolDiv.appendChild(btn);
             });
             div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
             App.appendChild(div);
        }

        // F. Roots
        function renderRoots() {
            if (checkVictory()) return;
            const target = State.queue[0];
            
            if (!State.tempData || State.tempData.word !== target.w) {
                 // Determine valid mode
                 let mode = 'syn';
                 if (target.a && target.a !== 'void' && target.a !== '-') {
                     // If ant exists, 50% chance, or if syn invalid force ant
                     if ((!target.s || target.s === 'void' || target.s === '-') || Math.random() > 0.5) mode = 'ant';
                 }
                 
                 const correct = mode === 'syn' ? target.s : target.a;
                 const distractors = State.pool.filter(i => i.w !== target.w).sort(() => 0.5 - Math.random()).slice(0, 3).map(i => i.w);
                 const opts = [...distractors, correct].sort(() => 0.5 - Math.random());
                 State.tempData = { mode: mode, word: target.w, correct: correct, options: opts, feedback: null };
            }

            const div = document.createElement('div');
            div.className = "flex flex-col items-center h-full w-full p-4 animate-fadeIn";
            div.innerHTML = `
                <div class="flex items-center justify-between w-full max-w-lg mb-8"><button id="back-btn" class="flex items-center text-stone-600 hover:text-stone-800">${ICONS.arrowLeft} Garden</button><span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-xs font-bold tracking-wider">ROOTS</span></div>
                <div class="text-center mb-10"><span class="text-stone-400 text-sm uppercase tracking-widest block mb-2">Find the ${State.tempData.mode === 'syn' ? 'Synonym' : 'Antonym'} for</span><div class="text-4xl font-serif font-bold text-stone-800 border-b-2 border-stone-200 pb-4 px-8 inline-block">${target.w}</div></div>
                <div class="grid grid-cols-2 gap-4 w-full max-w-lg" id="opts"></div>
            `;

            const grid = div.querySelector('#opts');
            State.tempData.options.forEach(opt => {
                 const btn = document.createElement('button');
                 let cls = "bg-white border-stone-200 hover:border-purple-300";
                 if (State.tempData.feedback !== null) {
                     if (opt === State.tempData.correct) cls = "bg-green-100 border-green-500 text-green-800";
                     else cls = "opacity-50";
                 }
                 btn.className = `p-6 rounded-xl border-2 text-lg font-bold transition-all ${cls}`;
                 btn.innerText = opt;
                 btn.onclick = () => {
                     if (State.tempData.feedback !== null) return;
                     const isCorrect = opt === State.tempData.correct;
                     State.tempData.feedback = isCorrect;
                     render();
                     if (isCorrect) {
                         setTimeout(() => { 
                             State.queue.shift(); 
                             updatePersistentQueue(); // SAVE PROGRESS
                             State.tempData = null; 
                             checkVictory() || render(); 
                         }, 1500);
                     } else { setTimeout(() => { State.tempData.feedback = null; render(); }, 1000); }
                 };
                 grid.appendChild(btn);
            });
            div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
            App.appendChild(div);
        }

        // G. Story
        function renderStory() {
            if (checkVictory()) return;
            const target = State.queue[0];

            if (!State.tempData || State.tempData.word !== target.w) {
                 const distractors = State.pool.filter(i => i.w !== target.w).sort(() => 0.5 - Math.random()).slice(0, 3);
                 const opts = [...distractors, target].sort(() => 0.5 - Math.random());
                 State.tempData = { word: target.w, opts: opts, feedback: null };
            }

            const prompt = target.ex || target.d; 
            const div = document.createElement('div');
            div.className = "flex flex-col items-center h-full w-full p-4 animate-fadeIn";
            div.innerHTML = `
                <div class="flex items-center justify-between w-full max-w-2xl mb-8"><button id="back-btn" class="flex items-center text-stone-600 hover:text-stone-800">${ICONS.arrowLeft} Garden</button><span class="bg-amber-100 text-amber-800 px-3 py-1 rounded-full text-xs font-bold tracking-wider">STORY STONES</span></div>
                <div class="bg-white p-8 rounded-2xl shadow-sm border border-stone-200 w-full max-w-2xl text-center mb-10 relative"><div class="absolute top-0 left-0 w-full h-2 bg-amber-200 rounded-t-2xl"></div><p class="text-2xl text-stone-700 font-serif leading-relaxed" id="sentence-display"></p></div>
                <div class="flex flex-wrap justify-center gap-4 w-full max-w-2xl" id="stones"></div>
            `;

            const display = div.querySelector('#sentence-display');
            if (prompt.includes('_____')) {
                const parts = prompt.split('_____');
                display.innerHTML = `"${parts[0]} <span class="inline-block w-24 border-b-2 border-stone-800 mx-2"></span> ${parts[1] || ''}"`;
            } else {
                display.innerHTML = `"${prompt}" <span class="block mt-4 text-sm text-stone-400 font-sans not-italic uppercase tracking-wider">(Definition)</span>`;
            }

            const stones = div.querySelector('#stones');
            State.tempData.opts.forEach(opt => {
                const btn = document.createElement('button');
                const isCorrect = opt.w === target.w;
                let cls = "bg-white border-stone-200 text-stone-600 hover:border-amber-400";
                
                if (State.tempData.feedback !== null) {
                    if (isCorrect) cls = "bg-green-600 text-white border-green-600 transform scale-105";
                    else cls = "opacity-50 bg-stone-100";
                }

                btn.className = `px-6 py-4 rounded-full border-2 text-lg font-bold shadow-sm transition-all min-w-[140px] ${cls}`;
                btn.innerText = opt.w;
                btn.onclick = () => {
                     if (State.tempData.feedback !== null) return;
                     State.tempData.feedback = isCorrect; render();
                     if (isCorrect) {
                         setTimeout(() => { 
                             State.queue.shift(); 
                             updatePersistentQueue(); // SAVE PROGRESS
                             State.tempData = null; 
                             checkVictory() || render(); 
                         }, 1500);
                     } else { setTimeout(() => { State.tempData.feedback = null; render(); }, 1000); }
                };
                stones.appendChild(btn);
            });
            div.querySelector('#back-btn').onclick = () => { State.view = 'menu'; render(); };
            App.appendChild(div);
        }

        render();
    </script>
</body>
</html>
