import React, { useState, useEffect, useMemo } from 'react';
import { BookOpen, Sprout, Hammer, ArrowLeft, Check, RefreshCcw, X, Star, Sun, Cloud, Leaf, Layers, ArrowRight } from 'lucide-react';

// --- DATA CONFIGURATION ---
// Paste your original data array here. 
// Expected format: Objects with keys: u (unit), w (word), d (def), s (syn), a (ant)
  const RAW_DATA = [
        // UNIT 1
        { u: 1, w: "celebrity", d: "A famous person.", s: "star, famous person", a: "unknown, nobody", ex: "The singer is a huge ______ with millions of fans." },
        { u: 1, w: "counsel", d: "To give advice; advice.", s: "advise, guidance", a: "ignore, disregard", ex: "The coach offered wise ______ on how to win the game." },
        { u: 1, w: "demonstrate", d: "To show clearly or explain.", s: "show, prove", a: "hide, conceal", ex: "Can you ______ how to solve that math problem?" },
        { u: 1, w: "drowsy", d: "Feeling sleepy or tired.", s: "sleepy, tired", a: "alert, awake", ex: "The warm milk made the baby feel ______." },
        { u: 1, w: "essential", d: "Completely necessary or important.", s: "necessary, vital", a: "unnecessary, optional", ex: "A helmet is ______ for riding a bike safely." },
        { u: 1, w: "hardship", d: "A difficulty or trouble.", s: "difficulty, suffering", a: "ease, comfort", ex: "The pioneers faced many ______ during their journey." },
        { u: 1, w: "haul", d: "To pull or drag with effort.", s: "drag, pull", a: "push, carry lightly", ex: "We had to ______ the heavy logs up the hill." },
        { u: 1, w: "humble", d: "Not proud; modest; simple.", s: "modest, plain", a: "proud, arrogant", ex: "Despite his success, he remained a very ______ man." },
        { u: 1, w: "pledge", d: "A serious promise.", s: "promise, vow", a: "break, deny", ex: "I made a ______ to always tell the truth." },
        { u: 1, w: "sincere", d: "Honest and truthful.", s: "honest, genuine", a: "fake, insincere", ex: "Her apology was ______, so I forgave her." },
        { u: 1, w: "stampede", d: "A sudden rush of startled animals or people.", s: "rush, bolt", a: "retreat, calm", ex: "The loud noise caused a ______ of cattle." },
        { u: 1, w: "suitable", d: "Right for a certain purpose; proper.", s: "appropriate, fitting", a: "unsuitable, wrong", ex: "These shoes are not ______ for hiking." },
        
        // --- PASTE YOUR UNITS 2-17 HERE ---
        
    // UNIT 2
    { u: 2, w: "annual", d: "Happening once a year.", s: "yearly, periodic", a: "daily, never", ex: "The town holds an ______ summer festival in July." },
    { u: 2, w: "basic", d: "Simple or fundamental.", s: "simple, main", a: "complex, advanced", ex: "Learning to read is a ______ skill for life." },
    { u: 2, w: "competition", d: "A contest or rivalry.", s: "contest, challenge", a: "cooperation, agreement", ex: "The two teams were in a tough ______ for the trophy." },
    { u: 2, w: "contract", d: "A written agreement.", s: "agreement, deal", a: "disagreement, breakup", ex: "They signed a ______ to buy the new house." },
    { u: 2, w: "dismiss", d: "To send away or let go.", s: "fire, let go", a: "hire, keep", ex: "The teacher had to ______ the student for bad behavior." },
    { u: 2, w: "neglect", d: "To fail to take care of something.", s: "ignore, abandon", a: "care for, attend to", ex: "If you ______ your homework, your grades will fall." },
    { u: 2, w: "obtain", d: "To get or acquire.", s: "get, gain", a: "lose, forfeit", ex: "She worked hard to ______ a good grade on the test." },
    { u: 2, w: "portion", d: "A part or share of something.", s: "share, part", a: "whole, entirety", ex: "I saved a small ______ of my dessert for later." },
    { u: 2, w: "recall", d: "To remember something.", s: "remember, recollect", a: "forget, overlook", ex: "I couldn't ______ the name of the movie we watched." },
    { u: 2, w: "sponsor", d: "A person or group who supports another.", s: "supporter, backer", a: "opponent, rival", ex: "A local business agreed to ______ the school's field day." },
    { u: 2, w: "stern", d: "Strict or serious.", s: "serious, strict", a: "gentle, easygoing", ex: "The principal gave a ______ warning about running in the halls." },
    { u: 2, w: "vacant", d: "Empty; not filled or occupied.", s: "empty, unoccupied", a: "occupied, full", ex: "The apartment has been ______ since the last tenants moved out." },

    // UNIT 3
    { u: 3, w: "attractive", d: "Pleasing to the eye or mind.", s: "pretty, appealing", a: "ugly, repulsive", ex: "The brightly colored flowers were very ______." },
    { u: 3, w: "burden", d: "A heavy load; something difficult to carry.", s: "load, worry", a: "ease, relief", ex: "The heavy backpack was a big ______ on the small child." },
    { u: 3, w: "consent", d: "To agree to something; agreement.", s: "agree, permission", a: "refuse, denial", ex: "You need your parents' ______ to go on the trip." },
    { u: 3, w: "dependable", d: "Trustworthy; reliable.", s: "reliable, trustworthy", a: "unreliable, shaky", ex: "A good friend should always be ______." },
    { u: 3, w: "indicate", d: "To point out or show.", s: "show, point to", a: "hide, conceal", ex: "The sign will ______ where the museum is located." },
    { u: 3, w: "previous", d: "Happening before or earlier.", s: "former, preceding", a: "next, following", ex: "We reviewed the material from the ______ chapter." },
    { u: 3, w: "qualify", d: "To meet the requirements or be fit for something.", s: "meet requirements, fit", a: "disqualify, be unfit", ex: "You need a license to ______ to drive a car." },
    { u: 3, w: "response", d: "An answer or reply.", s: "answer, reply", a: "question, query", ex: "I sent an email and waited for a ______." },
    { u: 3, w: "shabby", d: "Worn out or old-looking.", s: "worn, ragged", a: "new, clean", ex: "The old couch looked ______ and needed a new cover." },
    { u: 3, w: "thaw", d: "To melt or warm up.", s: "melt, defrost", a: "freeze, solidify", ex: "The snow began to ______ as the sun came out." },

    // UNIT 4
    { u: 4, w: "ambush", d: "A surprise attack from a hidden position.", s: "trap, surprise attack", a: "open attack, stand down", ex: "The soldiers planned an ______ in the thick woods." },
    { u: 4, w: "calculate", d: "To figure out using math.", s: "figure out, compute", a: "guess, estimate", ex: "I need to ______ how much paint we need for the room." },
    { u: 4, w: "contribute", d: "To give to a common purpose.", s: "donate, give", a: "take, withhold", ex: "Everyone should ______ a little money to the school fundraiser." },
    { u: 4, w: "dread", d: "To fear greatly or look forward to with fear.", s: "fear, worry", a: "welcome, anticipate happily", ex: "She ______ having to speak in front of the whole class." },
    { u: 4, w: "employ", d: "To hire someone for work.", s: "hire, use", a: "fire, dismiss", ex: "The company will ______ twenty new workers this year." },
    { u: 4, w: "extend", d: "To stretch out or make longer.", s: "lengthen, stretch", a: "shorten, contract", ex: "Can you ______ your arm so I can reach your hand?" },
    { u: 4, w: "frantic", d: "Wildly excited or worried.", s: "desperate, worried", a: "calm, peaceful", ex: "We made a ______ search for the lost car keys." },
    { u: 4, w: "initial", d: "First or beginning.", s: "beginning, starting", a: "final, last", ex: "The ______ plan was different from the final one." },
    { u: 4, w: "routine", d: "A regular, fixed way of doing things.", s: "schedule, habit", a: "random, unusual", ex: "Brushing your teeth is part of your daily ______." },
    { u: 4, w: "stun", d: "To shock or surprise greatly.", s: "amaze, daze", a: "bore, calm", ex: "The amazing magic trick completely ______ the audience." },
    { u: 4, w: "sturdy", d: "Strong and well-made.", s: "strong, solid", a: "weak, flimsy", ex: "The oak table was ______ and would last for years." },
    { u: 4, w: "yield", d: "To produce or give way to.", s: "produce, surrender", a: "keep, hold onto", ex: "The garden will ______ many fresh vegetables this summer." },

    // UNIT 5
    { u: 5, w: "antique", d: "Very old and valuable.", s: "old, vintage", a: "new, modern", ex: "She bought an ______ clock at the flea market." },
    { u: 5, w: "baggage", d: "Suitcases and belongings for travel.", s: "luggage, bags", a: "excess, clutter", ex: "We put all of our ______ in the trunk of the car." },
    { u: 5, w: "digest", d: "To break down food in the stomach.", s: "process, absorb", a: "reject, ignore", ex: "It takes time for your stomach to ______ a large meal." },
    { u: 5, w: "establish", d: "To set up or start.", s: "create, found", a: "demolish, end", ex: "They hope to ______ a new school in the neighborhood." },
    { u: 5, w: "eternal", d: "Lasting forever; endless.", s: "everlasting, endless", a: "temporary, short-lived", ex: "Many people believe the stars are a sign of ______ peace." },
    { u: 5, w: "haste", d: "Speed or quickness.", s: "hurry, rush", a: "slowness, delay", ex: "They finished the project in ______ and made many mistakes." },
    { u: 5, w: "humid", d: "Having a lot of moisture or water vapor in the air.", s: "damp, moist", a: "dry, arid", ex: "The air was hot and ______ right before the thunderstorm." },
    { u: 5, w: "lash", d: "To tie down or fasten securely.", s: "tie, fasten", a: "unfasten, untie", ex: "Make sure to ______ the boat to the dock with a strong rope." },
    { u: 5, w: "oppose", d: "To be against something.", s: "resist, fight", a: "support, agree with", ex: "Most of the students ______ the idea of longer school days." },
    { u: 5, w: "pioneer", d: "A person who goes first and settles a new land.", s: "settler, trailblazer", a: "follower, successor", ex: "The ______ traveled West to start a new life." },
    { u: 5, w: "sensible", d: "Showing good judgment or common sense.", s: "practical, wise", a: "foolish, illogical", ex: "Wearing a warm coat in winter is a ______ idea." },
    { u: 5, w: "worthy", d: "Deserving of respect or attention.", s: "deserving, excellent", a: "unworthy, bad", ex: "He proved himself to be a ______ leader for the class." },

    // UNIT 6
    { u: 6, w: "blossom", d: "A flower or to flower.", s: "bloom, flower", a: "fade, wither", ex: "The apple trees began to ______ in the spring." },
    { u: 6, w: "collide", d: "To crash into each other.", s: "crash, strike", a: "avoid, miss", ex: "Two cars ______ on the icy road." },
    { u: 6, w: "constant", d: "Happening all the time; never-ending.", s: "continuous, steady", a: "irregular, brief", ex: "The ______ noise from the construction site was annoying." },
    { u: 6, w: "content", d: "Happy and satisfied.", s: "satisfied, pleased", a: "unhappy, displeased", ex: "After a good meal, the baby felt ______ and fell asleep." },
    { u: 6, w: "distract", d: "To pull attention away from something.", s: "divert, bother", a: "focus, concentrate", ex: "Don't let the noise ______ you from your schoolwork." },
    { u: 6, w: "drought", d: "A long period without rain.", s: "dryness, lack of rain", a: "flood, downpour", ex: "The farm crops wilted during the long summer ______." },
    { u: 6, w: "foul", d: "Offensive or disgusting; against the rules.", s: "gross, wrong", a: "pleasant, fair", ex: "The rotten eggs had a ______ smell." },
    { u: 6, w: "noble", d: "High in moral quality; a high-ranking person.", s: "honorable, royal", a: "dishonorable, common", ex: "The knight performed a ______ act by saving the child." },
    { u: 6, w: "policy", d: "A rule or plan of action.", s: "rule, plan", a: "disorder, exception", ex: "The school has a strict ______ about being on time." },
    { u: 6, w: "quiver", d: "To tremble or shake slightly.", s: "shake, shiver", a: "stay still, calm", ex: "The tiny mouse began to ______ with fear." },
    { u: 6, w: "slight", d: "Small in amount; minor.", s: "small, minor", a: "large, huge", ex: "There was only a ______ chance of rain today." },
    { u: 6, w: "tidy", d: "Neat and orderly.", s: "neat, organized", a: "messy, disorganized", ex: "Please make sure your bedroom is ______ before playing games." },

    // UNIT 7
    { u: 7, w: "accurate", d: "Exactly correct; without mistakes.", s: "correct, exact", a: "wrong, false", ex: "She used a ruler to make sure her measurements were ______." },
    { u: 7, w: "alert", d: "Watchful and ready.", s: "watchful, attentive", a: "asleep, unaware", ex: "A good guard dog is always ______ for danger." },
    { u: 7, w: "ancestor", d: "A relative who lived in the past.", s: "forebear, relative", a: "descendant, offspring", ex: "My ______ came to this country many years ago." },
    { u: 7, w: "disaster", d: "A sudden event that causes great damage.", s: "catastrophe, tragedy", a: "blessing, success", ex: "The earthquake was a terrible ______ for the city." },
    { u: 7, w: "elementary", d: "Basic or simple.", s: "simple, beginning", a: "advanced, complex", ex: "First grade is the beginning of ______ school." },
    { u: 7, w: "envy", d: "To want what someone else has.", s: "jealousy, desire", a: "contentment, satisfaction", ex: "I felt ______ for my friend's brand-new bicycle." },
    { u: 7, w: "epidemic", d: "A sudden, widespread outbreak of a disease.", s: "outbreak, plague", a: "cure, rarity", ex: "A severe flu caused a widespread ______ in the city." },
    { u: 7, w: "feeble", d: "Weak and without strength.", s: "weak, frail", a: "strong, powerful", ex: "The sick man was too ______ to get out of bed." },
    { u: 7, w: "penetrate", d: "To go into or through something.", s: "pierce, bore", a: "exit, pull out", ex: "The sharp thorn managed to ______ the thick leather glove." },
    { u: 7, w: "romp", d: "To play or move in a lively, spirited way.", s: "play, frolic", a: "rest, walk slowly", ex: "The puppies ______ happily in the tall grass." },
    { u: 7, w: "staple", d: "A basic or necessary item.", s: "essential, main product", a: "extra, luxury", ex: "Rice is a ______ food in many countries." },
    { u: 7, w: "survive", d: "To stay alive or continue to exist.", s: "live, endure", a: "perish, die", ex: "Very few animals can ______ in the cold desert at night." },

    // UNIT 8
    { u: 8, w: "awkward", d: "Clumsy or difficult to handle.", s: "clumsy, uncomfortable", a: "graceful, smooth", ex: "Carrying three big boxes was an ______ task." },
    { u: 8, w: "clatter", d: "A loud, rattling noise.", s: "noise, racket", a: "silence, quiet", ex: "The plates made a loud ______ when they fell off the shelf." },
    { u: 8, w: "gallant", d: "Brave and heroic.", s: "brave, heroic", a: "cowardly, fearful", ex: "The ______ knight defended the castle from the dragon." },
    { u: 8, w: "lukewarm", d: "Slightly warm; neither hot nor cold.", s: "tepid, mild", a: "hot, icy", ex: "The tea was only ______ and needed to be heated up." },
    { u: 8, w: "plentiful", d: "Existing in large supply.", s: "abundant, ample", a: "scarce, rare", ex: "Wild berries are ______ in the forest during summer." },
    { u: 8, w: "ration", d: "A fixed amount of something allowed to a person.", s: "allowance, share", a: "entire amount, excess", ex: "During the war, the government had to ______ food." },
    { u: 8, w: "reserve", d: "To hold back or save for later.", s: "save, hold", a: "use, spend", ex: "We must ______ a table at the restaurant ahead of time." },
    { u: 8, w: "scholar", d: "A person who studies a lot and knows a lot.", s: "learned person, expert", a: "beginner, ignorant person", ex: "She is a brilliant ______ in the field of ancient history." },
    { u: 8, w: "smolder", d: "To burn slowly with smoke but no flame.", s: "burn, smoke", a: "flare, extinguish", ex: "The campfire began to ______ after the flames went out." },
    { u: 8, w: "trudge", d: "To walk slowly and with heavy steps.", s: "lumber, plod", a: "skip, walk quickly", ex: "We had to ______ through the deep, wet snow." },
    { u: 8, w: "volunteer", d: "A person who offers to do a service freely.", s: "helper, unpaid worker", a: "paid worker, forced labor", ex: "I decided to ______ my time at the animal shelter." },
    { u: 8, w: "weary", d: "Physically or mentally tired.", s: "tired, exhausted", a: "energetic, refreshed", ex: "The long hike made my legs feel ______." },

    // UNIT 9
    { u: 9, w: "convict", d: "To find someone guilty of a crime.", s: "find guilty, sentence", a: "acquit, pardon", ex: "The jury voted to ______ the suspect of the crime." },
    { u: 9, w: "discipline", d: "Training to obey rules; self-control.", s: "obedience, training", a: "chaos, disorder", ex: "Learning to play an instrument takes great ______." },
    { u: 9, w: "dungeon", d: "A dark, underground prison cell.", s: "jail, cell", a: "sky, freedom", ex: "The prisoner was locked away in the castle's ______." },
    { u: 9, w: "earnest", d: "Serious and sincere.", s: "serious, sincere", a: "playful, shallow", ex: "She made an ______ effort to study for the difficult exam." },
    { u: 9, w: "enclose", d: "To surround or close off on all sides.", s: "surround, fence in", a: "open, release", ex: "They will ______ the yard with a wooden fence." },
    { u: 9, w: "gradual", d: "Happening slowly over a long period.", s: "slow, steady", a: "sudden, rapid", ex: "The change in the weather was ______ as winter arrived." },
    { u: 9, w: "grumble", d: "To complain in a low voice.", s: "complain, mutter", a: "cheer, praise", ex: "He began to ______ about having to clean his room." },
    { u: 9, w: "jagged", d: "Having sharp, uneven points.", s: "rough, spiky", a: "smooth, even", ex: "The broken glass left a ______ edge on the table." },
    { u: 9, w: "nourish", d: "To provide food or support for growth.", s: "feed, nurture", a: "starve, neglect", ex: "Good food and rest will ______ a growing child." },
    { u: 9, w: "provision", d: "A supply of necessary items, especially food.", s: "supply, arrangement", a: "lack, scarcity", ex: "We bought extra food and ______ for the long camping trip." },
    { u: 9, w: "treaty", d: "A formal agreement between two or more countries.", s: "agreement, pact", a: "disagreement, conflict", ex: "The two nations signed a peace ______ to end the war." },
    { u: 9, w: "uneasy", d: "Feeling worried or uncomfortable.", s: "worried, anxious", a: "calm, relaxed", ex: "I felt ______ when I was home alone in the dark." },

    // UNIT 10
    { u: 10, w: "distress", d: "Great pain, suffering, or sadness.", s: "pain, trouble", a: "comfort, joy", ex: "The stranded hikers were in great ______." },
    { u: 10, w: "drench", d: "To make completely wet.", s: "soak, saturate", a: "dry, parch", ex: "The sudden rainstorm will ______ everyone who is outside." },
    { u: 10, w: "dwell", d: "To live in a place.", s: "live, reside", a: "move, leave", ex: "I have always wished to ______ in a house near the ocean." },
    { u: 10, w: "juvenile", d: "Relating to young people; a young person.", s: "young, youthful", a: "adult, mature", ex: "The crime committed by the teenager was a ______ offense." },
    { u: 10, w: "outstanding", d: "Excellent or very noticeable.", s: "excellent, amazing", a: "bad, average", ex: "She gave an ______ performance in the school play." },
    { u: 10, w: "proceed", d: "To move forward or go on.", s: "continue, advance", a: "stop, retreat", ex: "We waited for the light to turn green before we could ______." },
    { u: 10, w: "register", d: "To record or enroll officially.", s: "sign up, enroll", a: "withdraw, forget", ex: "You need to ______ to vote in the upcoming election." },
    { u: 10, w: "sift", d: "To put a fine material through a strainer.", s: "strain, filter", a: "lump, combine", ex: "You should always ______ the flour before baking a cake." },
    { u: 10, w: "spree", d: "A lively or wild outburst of activity.", s: "binge, burst", a: "scarcity, lack", ex: "They went on a shopping ______ and spent all their money." },
    { u: 10, w: "tardy", d: "Late; not on time.", s: "late, delayed", a: "early, on time", ex: "Students who are ______ will need to get a note from the office." },
    { u: 10, w: "unfit", d: "Not suitable or good enough.", s: "unsuitable, unhealthy", a: "suitable, fit", ex: "Eating too much junk food will make you ______ for sports." },
    { u: 10, w: "variety", d: "A number of different kinds.", s: "assortment, mix", a: "same, uniformity", ex: "The store offers a large ______ of fresh fruits and vegetables." },

    // UNIT 11
    { u: 11, w: "blockade", d: "A barrier that prevents movement.", s: "barrier, stop", a: "opening, path", ex: "The fallen tree created a ______ across the main road." },
    { u: 11, w: "chant", d: "To sing or say in a repeating, rhythmic way.", s: "sing, repeat", a: "whisper, speak softly", ex: "The crowd began to ______ the name of their favorite player." },
    { u: 11, w: "despair", d: "A feeling of complete lack of hope.", s: "hopelessness, sadness", a: "hope, happiness", ex: "After losing his dog, he fell into deep ______." },
    { u: 11, w: "elevate", d: "To lift or raise to a higher position.", s: "lift, raise", a: "lower, drop", ex: "We used a crane to ______ the materials to the roof." },
    { u: 11, w: "extraordinary", d: "Beyond the usual; remarkable.", s: "amazing, special", a: "ordinary, normal", ex: "It was an ______ rescue, as they saved all the passengers." },
    { u: 11, w: "heroic", d: "Very brave and showing great courage.", s: "brave, courageous", a: "cowardly, weak", ex: "The firefighter made a ______ effort to save the cat from the tree." },
    { u: 11, w: "lance", d: "A long, sharp weapon for thrusting.", s: "spear, weapon", a: "shield, protection", ex: "The knight carried a ______ as he rode his horse into battle." },
    { u: 11, w: "missionary", d: "A person sent to promote a religion in a foreign country.", s: "evangelist, preacher", a: "skeptic, nonbeliever", ex: "The ______ traveled overseas to help the poor." },
    { u: 11, w: "pointless", d: "Having no purpose or meaning.", s: "useless, senseless", a: "useful, meaningful", ex: "Arguing about the weather is completely ______." },
    { u: 11, w: "reflect", d: "To think deeply about something; to bounce back light.", s: "consider, mirror", a: "ignore, absorb", ex: "She took a moment to ______ on her mistakes." },
    { u: 11, w: "site", d: "A location or area.", s: "location, place", a: "entire area, non-place", ex: "This ______ is where the new school will be built." },
    { u: 11, w: "toxic", d: "Poisonous or harmful.", s: "poisonous, deadly", a: "harmless, safe", ex: "Be careful not to spill any of the ______ cleaning chemicals." },

    // UNIT 12
    { u: 12, w: "bristle", d: "A short, stiff hair; to show sudden anger.", s: "hair, spine", a: "smooth skin, calmness", ex: "The boar's coarse ______ felt rough to the touch." },
    { u: 12, w: "circular", d: "Having the shape of a circle.", s: "round, ring-shaped", a: "straight, square", ex: "They sat around the ______ table to play a game." },
    { u: 12, w: "coarse", d: "Rough or harsh in texture.", s: "rough, scratchy", a: "smooth, soft", ex: "The sandpaper felt very ______ against my skin." },
    { u: 12, w: "discard", d: "To throw away or get rid of.", s: "throw away, toss", a: "keep, save", ex: "Please ______ all your trash into the proper bin." },
    { u: 12, w: "extreme", d: "The greatest or farthest point.", s: "intense, maximum", a: "moderate, mild", ex: "Climbing Mount Everest is an ______ challenge." },
    { u: 12, w: "focus", d: "To concentrate attention on something.", s: "concentrate, center", a: "ignore, disperse", ex: "Try to ______ on your book and ignore the noise." },
    { u: 12, w: "grasp", d: "To take hold of something firmly.", s: "grip, hold", a: "release, drop", ex: "She used a strong hand to ______ the rope firmly." },
    { u: 12, w: "inspire", d: "To fill someone with the urge or ability to do something.", s: "motivate, encourage", a: "discourage, bore", ex: "Her story will ______ others to chase their dreams." },
    { u: 12, w: "magnify", d: "To make something look larger than it is.", s: "enlarge, zoom in", a: "shrink, reduce", ex: "We used a lens to ______ the tiny insects." },
    { u: 12, w: "marine", d: "Relating to the sea or ocean.", s: "sea, aquatic", a: "land, terrestrial", ex: "Whales and dolphins are beautiful ______ animals." },
    { u: 12, w: "quake", d: "To shake or tremble.", s: "shake, shiver", a: "stabilize, hold firm", ex: "The old house seemed to ______ during the loud thunderstorm." },
    { u: 12, w: "troublesome", d: "Causing difficulty or annoyance.", s: "annoying, difficult", a: "easy, pleasant", ex: "The constant barking of the dog was quite ______." },

    // UNIT 13
    { u: 13, w: "abstract", d: "Existing only as an idea; not concrete.", s: "theoretical, non-physical", a: "concrete, real", ex: "Happiness is an ______ idea that is hard to describe." },
    { u: 13, w: "ally", d: "A person or country joined with another for a common purpose.", s: "partner, friend", a: "enemy, opponent", ex: "The two nations became close ______ to fight a war." },
    { u: 13, w: "appoint", d: "To choose a person for a job or position.", s: "select, assign", a: "dismiss, remove", ex: "The president will ______ a new judge to the court." },
    { u: 13, w: "attentive", d: "Paying close attention.", s: "observant, watchful", a: "careless, distracted", ex: "She was an ______ listener in class and took good notes." },
    { u: 13, w: "bonus", d: "Something extra given as a reward.", s: "extra, reward", a: "loss, penalty", ex: "The company gave everyone a large ______ at the end of the year." },
    { u: 13, w: "carefree", d: "Without worries; lighthearted.", s: "relaxed, cheerful", a: "worried, serious", ex: "We spent a ______ summer afternoon swimming in the lake." },
    { u: 13, w: "courtesy", d: "Polite behavior; good manners.", s: "politeness, respect", a: "rudeness, disrespect", ex: "She showed great ______ by holding the door open for the elderly man." },
    { u: 13, w: "manufacture", d: "To make something, usually in a factory.", s: "produce, make", a: "destroy, buy", ex: "The factory is able to ______ hundreds of toys each day." },
    { u: 13, w: "mistrust", d: "Lack of trust or confidence.", s: "doubt, suspicion", a: "trust, belief", ex: "The long history of lies caused deep ______ between them." },
    { u: 13, w: "noticeable", d: "Easy to see or observe.", s: "obvious, clear", a: "hidden, invisible", ex: "The difference in their heights was very ______." },
    { u: 13, w: "overthrow", d: "To remove from power; to defeat.", s: "remove, topple", a: "install, support", ex: "The people planned to ______ the cruel king." },
    { u: 13, w: "peculiar", d: "Strange or unusual.", s: "odd, strange", a: "normal, common", ex: "The dog had a ______ habit of chasing its own tail." },

    // UNIT 14
    { u: 14, w: "absolute", d: "Complete, total, or without limits.", s: "total, entire", a: "partial, limited", ex: "You have my ______ permission to use my computer." },
    { u: 14, w: "arena", d: "A place for public events or sports.", s: "stadium, venue", a: "home, private space", ex: "The famous singer will perform in the large city ______." },
    { u: 14, w: "compliment", d: "An expression of praise or admiration.", s: "praise, flattery", a: "insult, criticism", ex: "The teacher gave the student a ______ on her good writing." },
    { u: 14, w: "deliberate", d: "Done on purpose; carefully considered.", s: "intentional, planned", a: "accidental, careless", ex: "The slow movements were careful and ______." },
    { u: 14, w: "dense", d: "Closely packed together; thick.", s: "thick, crowded", a: "sparse, thin", ex: "The forest was so ______ that sunlight could barely reach the ground." },
    { u: 14, w: "dominant", d: "Most important, powerful, or controlling.", s: "main, powerful", a: "minor, weak", ex: "The lion is the ______ animal in the savanna." },
    { u: 14, w: "hazardous", d: "Dangerous or risky.", s: "dangerous, unsafe", a: "safe, secure", ex: "Do not go near the sign that says \"______ materials.\"" },
    { u: 14, w: "huddle", d: "To crowd together closely.", s: "cluster, gather", a: "scatter, spread out", ex: "The sheep began to ______ together for warmth in the snow." },
    { u: 14, w: "necessity", d: "Something that is needed or essential.", s: "requirement, must-have", a: "luxury, extra", ex: "Food and water are a basic ______ for all life." },
    { u: 14, w: "offend", d: "To hurt someone's feelings; to insult.", s: "insult, displease", a: "compliment, please", ex: "I hope I didn't ______ you with my clumsy comment." },
    { u: 14, w: "regain", d: "To get something back.", s: "recover, restore", a: "lose, surrender", ex: "He worked hard to ______ his health after the long illness." },
    { u: 14, w: "thorough", d: "Complete and very careful.", s: "careful, detailed", a: "careless, incomplete", ex: "The detective did a ______ search of the entire house." },

    // UNIT 15
    { u: 15, w: "adopt", d: "To take a child into your family or to take up an idea.", s: "take in, accept", a: "reject, abandon", ex: "The couple decided to ______ a child from the orphanage." },
    { u: 15, w: "agile", d: "Able to move quickly and easily.", s: "nimble, quick", a: "clumsy, stiff", ex: "The mountain goat was very ______ as it climbed the rocks." },
    { u: 15, w: "analyze", d: "To study something closely and carefully.", s: "examine, study", a: "guess, ignore", ex: "The scientist will ______ the soil sample for traces of pollution." },
    { u: 15, w: "assist", d: "To help or aid someone.", s: "help, aid", a: "hinder, block", ex: "The older student agreed to ______ the younger kids with their math homework." },
    { u: 15, w: "babble", d: "To make sounds like a baby; to talk foolishly.", s: "chatter, mumble", a: "speak clearly, be quiet", ex: "The little baby would often ______ when playing with toys." },
    { u: 15, w: "captivity", d: "The state of being held as a prisoner.", s: "imprisonment, confinement", a: "freedom, liberty", ex: "The zoo works to protect animals kept in ______." },
    { u: 15, w: "drab", d: "Dull, boring, and colorless.", s: "dull, uninteresting", a: "bright, colorful", ex: "The walls of the old building were a ______ shade of gray." },
    { u: 15, w: "fatal", d: "Causing death.", s: "deadly, lethal", a: "harmless, safe", ex: "The fall from the cliff proved to be ______." },
    { u: 15, w: "generosity", d: "The quality of being kind and giving.", s: "kindness, giving", a: "selfishness, greed", ex: "Her ______ led her to donate a lot of money to the poor." },
    { u: 15, w: "genuine", d: "Real, true, or sincere.", s: "real, authentic", a: "fake, false", ex: "I could tell by her smile that her happiness was ______." },
    { u: 15, w: "illegal", d: "Against the law.", s: "unlawful, forbidden", a: "legal, lawful", ex: "Driving without a license is completely ______." },
    { u: 15, w: "merit", d: "Deserving of reward or praise.", s: "worth, value", a: "fault, flaw", ex: "The judges decided the painting had great artistic ______." },

    // UNIT 16
    { u: 16, w: "adorn", d: "To decorate or make beautiful.", s: "decorate, embellish", a: "strip, damage", ex: "She used flowers and lights to ______ the party room." },
    { u: 16, w: "appropriate", d: "Right for the purpose; suitable.", s: "suitable, proper", a: "inappropriate, wrong", ex: "That outfit is not ______ for a formal wedding ceremony." },
    { u: 16, w: "assemble", d: "To bring or put together.", s: "gather, connect", a: "scatter, disassemble", ex: "We need to ______ all the parts to build the new toy." },
    { u: 16, w: "colossal", d: "Extremely large or huge.", s: "huge, gigantic", a: "tiny, small", ex: "The new skyscraper was a ______ building in the city skyline." },
    { u: 16, w: "effective", d: "Producing the desired result.", s: "successful, potent", a: "useless, weak", ex: "This medicine is very ______ at curing a headache." },
    { u: 16, w: "frail", d: "Weak and easily damaged.", s: "delicate, weak", a: "strong, sturdy", ex: "The small bird seemed so ______ in the cold winter air." },
    { u: 16, w: "hostage", d: "A person held prisoner until demands are met.", s: "captive, prisoner", a: "guard, captor", ex: "The criminals held the bank manager as a ______." },
    { u: 16, w: "landslide", d: "A sudden, rapid movement of earth and rocks down a slope.", s: "mudslide, collapse", a: "stability, firmness", ex: "Heavy rain caused a ______ that blocked the mountain road." },
    { u: 16, w: "rampage", d: "To rush around in a wild, destructive way.", s: "storm, rush", a: "calm, be gentle", ex: "The escaped tiger went on a destructive ______ through the jungle." },
    { u: 16, w: "scamper", d: "To run or move quickly and playfully.", s: "dash, hurry", a: "stroll, walk slowly", ex: "The little squirrel began to ______ up the oak tree." },
    { u: 16, w: "symptom", d: "A sign or indication of a disease.", s: "sign, indication", a: "cause, cure", ex: "A fever can be a ______ of the flu." },
    { u: 16, w: "warrant", d: "A written order that gives authority; to justify.", s: "authorization, justify", a: "denial, ignore", ex: "The police needed a ______ to search the house." },

    // UNIT 17
    { u: 17, w: "approximate", d: "Close to the actual amount; nearly exact.", s: "estimate, near", a: "exact, precise", ex: "I can only give you an ______ guess of the travel time." },
    { u: 17, w: "construct", d: "To build or put together.", s: "build, make", a: "demolish, destroy", ex: "The workers plan to ______ a new bridge over the river." },
    { u: 17, w: "crude", d: "Not carefully made; rough or simple.", s: "raw, simple", a: "refined, polished", ex: "The settlers lived in a ______ cabin made of logs." },
    { u: 17, w: "decline", d: "To refuse to accept; to gradually fall.", s: "refuse, drop", a: "accept, increase", ex: "The price of gasoline began to ______ after the holidays." },
    { u: 17, w: "distinct", d: "Clearly different; easily seen.", s: "clear, separate", a: "vague, similar", ex: "The parrot has two ______ colors on its wings." },
    { u: 17, w: "evident", d: "Easy to see or understand; obvious.", s: "obvious, clear", a: "hidden, unclear", ex: "It was ______ from her smile that she was very happy." },
    { u: 17, w: "impulse", d: "A sudden, strong desire to act.", s: "urge, whim", a: "plan, thought", ex: "I bought the candy bar on a sudden ______ at the checkout." },
    { u: 17, w: "interpret", d: "To explain the meaning of something.", s: "explain, translate", a: "confuse, misunderstand", ex: "The travel guide was there to ______ the ancient writings." },
    { u: 17, w: "orient", d: "To adjust to a situation or position.", s: "align, adapt", a: "confuse, disorient", ex: "The map helped us ______ ourselves in the new city." },
    { u: 17, w: "sector", d: "A part or division of an area.", s: "part, zone", a: "whole, entirety", ex: "The police searched the northeast ______ of the park." },
    { u: 17, w: "submit", d: "To give in to another's power; to present for review.", s: "yield, hand in", a: "resist, withdraw", ex: "You must ______ your final paper by the end of the day." },
    { u: 17, w: "zest", d: "Great enthusiasm or excitement.", s: "enthusiasm, energy", a: "dullness, boredom", ex: "She went on the trip with great ______ and excitement." },

 
        // UNIT 18
        { u: 18, w: "depress", d: "To make sad or lower in spirits.", s: "sadden, discourage", a: "cheer, elevate", ex: "The gray, rainy weather began to ______ my mood." },
        { u: 18, w: "dismal", d: "Causing gloom or sadness.", s: "gloomy, sad", a: "cheerful, joyful", ex: "The team played a ______ game and lost by a large score." },
        { u: 18, w: "dispose", d: "To get rid of something.", s: "discard, dump", a: "keep, save", ex: "Please ______ of your garbage in the proper bin." },
        { u: 18, w: "exaggerate", d: "To describe something as larger or greater than it really is.", s: "overstate, inflate", a: "minimize, understate", ex: "He tends to ______ his stories to make them sound more exciting." },
        { u: 18, w: "indifferent", d: "Not caring or interested.", s: "unconcerned, uncaring", a: "interested, concerned", ex: "I was ______ as to whether we watched a movie or read a book." },
        { u: 18, w: "jubilant", d: "Feeling or expressing great joy.", s: "joyful, thrilled", a: "sad, depressed", ex: "The crowd was ______ when their team won the championship." },
        { u: 18, w: "manual", d: "Done by hand; a handbook.", s: "hand-operated, guide", a: "automatic, digital", ex: "Turning the large crank required ______ effort." },
        { u: 18, w: "originate", d: "To come from or begin somewhere.", s: "begin, start", a: "end, finish", ex: "The river is said to ______ high up in the mountains." },
        { u: 18, w: "recognition", d: "Acknowledgment or appreciation.", s: "praise, credit", a: "disregard, neglect", ex: "The brave soldier received a medal in ______ of his service." },
        { u: 18, w: "tribute", d: "Something given or done to show respect.", s: "praise, honor", a: "insult, criticism", ex: "We held a short ______ to honor the founder of the school." }
    ];

// --- COMPONENTS ---

// 0. Unit Selection (The Garden Gate)
const UnitSelection = ({ units, onStart }) => {
  const [selected, setSelected] = useState([]);

  const toggleUnit = (unit) => {
    setSelected(prev => 
      prev.includes(unit) ? prev.filter(u => u !== unit) : [...prev, unit]
    );
  };

  const handleSelectAll = () => {
    if (selected.length === units.length) setSelected([]);
    else setSelected([...units]);
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-[60vh] w-full max-w-2xl mx-auto p-6 animate-fadeIn">
      <div className="text-center mb-8">
        <h1 className="text-4xl md:text-5xl font-serif text-stone-800 mb-2">Vocabulary Garden</h1>
        <p className="text-stone-500 italic">Open the gate to begin.</p>
      </div>

      <div className="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 w-full mb-8">
        <div className="flex justify-between items-center mb-4 pb-4 border-b border-stone-100">
          <h2 className="text-lg font-bold text-stone-700">Select Collections</h2>
          <button 
            onClick={handleSelectAll}
            className="text-sm text-green-600 font-medium hover:text-green-800"
          >
            {selected.length === units.length ? "Deselect All" : "Select All"}
          </button>
        </div>
        
        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
          {units.map(unit => (
            <button
              key={unit}
              onClick={() => toggleUnit(unit)}
              className={`flex items-center p-3 rounded-lg text-left transition-all border-2
                ${selected.includes(unit) 
                  ? 'bg-green-50 border-green-500 text-green-900' 
                  : 'bg-stone-50 border-transparent hover:bg-stone-100 text-stone-600'
                }`}
            >
              <div className={`w-5 h-5 rounded border mr-3 flex items-center justify-center transition-colors
                ${selected.includes(unit) ? 'bg-green-500 border-green-500' : 'border-stone-300 bg-white'}
              `}>
                {selected.includes(unit) && <Check size={14} className="text-white" />}
              </div>
              <span className="text-sm font-medium truncate">{unit}</span>
            </button>
          ))}
        </div>
      </div>

      <button 
        disabled={selected.length === 0}
        onClick={() => onStart(selected)}
        className={`px-8 py-3 rounded-full font-bold text-lg shadow-md transition-all flex items-center gap-2
          ${selected.length === 0 
            ? 'bg-stone-200 text-stone-400 cursor-not-allowed' 
            : 'bg-green-700 text-white hover:bg-green-800 hover:scale-105'
          }`}
      >
        Enter Garden <ArrowRight size={20} />
      </button>
    </div>
  );
};

// 1. The Sketchbook (Flashcards)
const Sketchbook = ({ pool, onBack, onMastery }) => {
  const [index, setIndex] = useState(0);
  const [flipped, setFlipped] = useState(false);
  
  const currentCard = pool[index];

  const nextCard = () => {
    setFlipped(false);
    setTimeout(() => {
      setIndex((prev) => (prev + 1) % pool.length);
    }, 200);
  };

  const markMastered = () => {
    onMastery(); 
    nextCard();
  };

  return (
    <div className="flex flex-col items-center justify-center h-full w-full p-4 animate-fadeIn">
      <div className="flex items-center justify-between w-full max-w-md mb-6">
        <button onClick={onBack} className="flex items-center text-stone-600 hover:text-stone-800 transition-colors">
          <ArrowLeft size={20} className="mr-2" /> Garden
        </button>
        <span className="text-stone-500 font-serif italic">Card {index + 1} of {pool.length}</span>
      </div>

      <div 
        onClick={() => setFlipped(!flipped)}
        className="cursor-pointer group perspective-1000 w-full max-w-md h-96 relative"
      >
        <div className={`relative w-full h-full transition-transform duration-700 transform-style-3d ${flipped ? 'rotate-y-180' : ''}`}>
          
          {/* Front */}
          <div className="absolute w-full h-full backface-hidden bg-white rounded-xl shadow-[4px_4px_0px_0px_rgba(214,211,209,1)] border-2 border-stone-200 flex flex-col items-center justify-center p-8 bg-paper-pattern">
            <span className="text-stone-400 text-xs absolute top-4 right-4 uppercase tracking-wider">{currentCard.u}</span>
            <h2 className="text-4xl text-stone-800 font-serif font-medium tracking-wide text-center">{currentCard.w}</h2>
            <div className="mt-8 text-stone-400 text-sm flex items-center gap-2">
              <RefreshCcw size={14} /> Tap to reveal meaning
            </div>
          </div>

          {/* Back */}
          <div className="absolute w-full h-full backface-hidden bg-stone-50 rounded-xl shadow-[4px_4px_0px_0px_rgba(168,162,158,1)] border-2 border-stone-300 flex flex-col items-center justify-center p-8 rotate-y-180 bg-paper-pattern">
            <span className="text-stone-400 text-sm absolute top-4 right-4">Definition</span>
            <p className="text-xl text-stone-700 text-center font-medium leading-relaxed mb-6">
              "{currentCard.d}"
            </p>
            <div className="w-full grid grid-cols-2 gap-4 mt-4 border-t-2 border-dashed border-stone-200 pt-4">
              <div className="text-center">
                <span className="block text-xs uppercase tracking-widest text-stone-400 mb-1">Synonym</span>
                <span className="text-stone-600 font-serif italic">{currentCard.s || '-'}</span>
              </div>
              <div className="text-center">
                <span className="block text-xs uppercase tracking-widest text-stone-400 mb-1">Antonym</span>
                <span className="text-stone-600 font-serif italic">{currentCard.a || '-'}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div className="flex gap-4 mt-8 w-full max-w-md">
        <button 
          onClick={(e) => { e.stopPropagation(); nextCard(); }}
          className="flex-1 py-3 px-6 rounded-lg border-2 border-stone-300 text-stone-500 font-bold hover:bg-stone-100 transition-colors"
        >
          Study Again
        </button>
        <button 
          onClick={(e) => { e.stopPropagation(); markMastered(); }}
          className="flex-1 py-3 px-6 rounded-lg bg-green-700/90 text-white font-bold shadow-md hover:bg-green-800 hover:shadow-lg transition-all flex items-center justify-center gap-2"
        >
          <Check size={18} /> Got it!
        </button>
      </div>
    </div>
  );
};

// 2. Word Workshop (Spelling)
const WordWorkshop = ({ pool, onBack, onMastery }) => {
  const [currentIdx, setCurrentIdx] = useState(0);
  const [shuffledLetters, setShuffledLetters] = useState([]);
  const [placedLetters, setPlacedLetters] = useState([]);
  const [isCorrect, setIsCorrect] = useState(null);

  const targetWord = pool[currentIdx].w;

  useEffect(() => {
    resetRound();
  }, [currentIdx]);

  const resetRound = () => {
    const letters = pool[currentIdx].w.split('').map((l, i) => ({ val: l, id: i }));
    // Shuffle
    for (let i = letters.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [letters[i], letters[j]] = [letters[j], letters[i]];
    }
    setShuffledLetters(letters);
    setPlacedLetters(Array(letters.length).fill(null));
    setIsCorrect(null);
  };

  const handleTileClick = (letterObj) => {
    if (isCorrect) return; 
    const firstEmptyIndex = placedLetters.indexOf(null);
    if (firstEmptyIndex !== -1) {
      const newPlaced = [...placedLetters];
      newPlaced[firstEmptyIndex] = letterObj;
      setPlacedLetters(newPlaced);
      setShuffledLetters(prev => prev.filter(l => l.id !== letterObj.id));
      if (firstEmptyIndex === placedLetters.length - 1) checkWin(newPlaced);
    }
  };

  const handleSlotClick = (index) => {
    if (isCorrect) return;
    const letterToReturn = placedLetters[index];
    if (letterToReturn) {
      const newPlaced = [...placedLetters];
      newPlaced[index] = null;
      setPlacedLetters(newPlaced);
      setShuffledLetters(prev => [...prev, letterToReturn]);
    }
  };

  const checkWin = (currentPlaced) => {
    const attemptedWord = currentPlaced.map(l => l.val).join('');
    if (attemptedWord === targetWord) {
      setIsCorrect(true);
      onMastery();
      setTimeout(() => {
        if (currentIdx < pool.length - 1) setCurrentIdx(prev => prev + 1);
        else setCurrentIdx(0); 
      }, 1500);
    } else {
      setIsCorrect(false);
      setTimeout(() => setIsCorrect(null), 1000);
    }
  };

  return (
    <div className="flex flex-col items-center justify-start h-full w-full p-4 animate-fadeIn">
      <div className="flex items-center justify-between w-full max-w-lg mb-8">
        <button onClick={onBack} className="flex items-center text-stone-600 hover:text-stone-800">
          <ArrowLeft size={20} className="mr-2" /> Garden
        </button>
        <span className="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-xs font-bold tracking-wider">WORKSHOP</span>
      </div>

      <div className="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 w-full max-w-lg text-center mb-8 relative overflow-hidden">
        <div className="absolute top-0 left-0 w-full h-1 bg-orange-300"></div>
        <h3 className="text-stone-400 text-sm uppercase tracking-widest mb-2">Build the word for:</h3>
        <p className="text-xl text-stone-800 font-medium leading-relaxed">"{pool[currentIdx].d}"</p>
      </div>

      <div className={`flex flex-wrap justify-center gap-2 mb-10 transition-transform ${isCorrect === false ? 'animate-shake' : ''}`}>
        {placedLetters.map((letter, idx) => (
          <button
            key={idx}
            onClick={() => handleSlotClick(idx)}
            className={`w-10 h-12 md:w-12 md:h-14 rounded-lg flex items-center justify-center text-xl md:text-2xl font-bold shadow-inner transition-all
              ${letter 
                ? isCorrect === true 
                  ? 'bg-green-100 text-green-700 border-2 border-green-300' 
                  : 'bg-stone-100 text-stone-800 border-2 border-stone-300 hover:bg-red-50' 
                : 'bg-stone-50 border-2 border-dashed border-stone-200'
              }`}
          >
            {letter ? letter.val : ''}
          </button>
        ))}
      </div>

      <div className="flex flex-wrap justify-center gap-2 md:gap-3 max-w-lg">
        {shuffledLetters.map((letter) => (
          <button
            key={letter.id}
            onClick={() => handleTileClick(letter)}
            className="w-10 h-12 md:w-12 md:h-14 bg-amber-200 rounded-lg shadow-[0px_4px_0px_0px_rgba(217,119,6,1)] border-t border-amber-100 flex items-center justify-center text-xl md:text-2xl font-bold text-amber-900 active:translate-y-1 active:shadow-none transition-transform"
          >
            {letter.val}
          </button>
        ))}
      </div>
    </div>
  );
};

// 3. Pebble Paths (Quiz / Multiple Choice)
const PebblePaths = ({ pool, onBack, onMastery }) => {
  const [currentIdx, setCurrentIdx] = useState(0);
  const [options, setOptions] = useState([]);
  const [selectedOption, setSelectedOption] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);

  useEffect(() => {
    generateQuestion();
  }, [currentIdx]);

  const generateQuestion = () => {
    const correct = pool[currentIdx];
    // Get 3 distractors
    const distractors = pool
        .filter(i => i.w !== correct.w)
        .sort(() => 0.5 - Math.random())
        .slice(0, 3);
    
    const allOptions = [...distractors, correct].sort(() => 0.5 - Math.random());
    setOptions(allOptions);
    setSelectedOption(null);
    setIsCorrect(null);
  };

  const handleSelect = (item) => {
    if (selectedOption) return; // Lock
    setSelectedOption(item);
    
    const correct = item.w === pool[currentIdx].w;
    setIsCorrect(correct);

    if (correct) {
      onMastery();
      setTimeout(() => {
        if (currentIdx < pool.length - 1) setCurrentIdx(prev => prev + 1);
        else setCurrentIdx(0);
      }, 1500);
    } else {
       setTimeout(() => {
           setSelectedOption(null);
           setIsCorrect(null);
       }, 1500);
    }
  };

  return (
    <div className="flex flex-col items-center justify-start h-full w-full p-4 animate-fadeIn">
        <div className="flex items-center justify-between w-full max-w-2xl mb-8">
            <button onClick={onBack} className="flex items-center text-stone-600 hover:text-stone-800">
            <ArrowLeft size={20} className="mr-2" /> Garden
            </button>
            <span className="bg-slate-100 text-slate-800 px-3 py-1 rounded-full text-xs font-bold tracking-wider">PEBBLE SORTING</span>
        </div>

        <div className="text-center mb-8">
            <span className="text-stone-400 text-sm uppercase tracking-widest">Find the meaning of</span>
            <h2 className="text-4xl text-stone-800 font-serif font-bold mt-2">{pool[currentIdx].w}</h2>
        </div>

        <div className="grid grid-cols-1 gap-4 w-full max-w-2xl">
            {options.map((opt, i) => {
                const isSelected = selectedOption === opt;
                const isTarget = opt.w === pool[currentIdx].w;
                
                let styleClass = "bg-white border-stone-200 hover:border-slate-400 hover:bg-slate-50";
                if (isSelected) {
                    if (isTarget) styleClass = "bg-green-100 border-green-500 text-green-800 shadow-none";
                    else styleClass = "bg-red-50 border-red-300 text-red-800 shadow-none animate-shake";
                } else if (selectedOption && isTarget) {
                    // Show correct answer if wrong one picked
                    styleClass = "bg-green-50 border-green-300 text-green-700 opacity-70";
                }

                return (
                    <button
                        key={i}
                        onClick={() => handleSelect(opt)}
                        className={`p-5 rounded-2xl border-2 shadow-sm text-left transition-all duration-200 flex items-start gap-4 ${styleClass}`}
                    >
                        <div className={`mt-1 min-w-[24px] h-6 rounded-full border-2 flex items-center justify-center
                            ${isSelected && isTarget ? 'border-green-600 bg-green-600 text-white' : 'border-stone-300'}
                        `}>
                            {isSelected && isTarget && <Check size={14} />}
                            {isSelected && !isTarget && <X size={14} />}
                        </div>
                        <span className="text-lg font-medium leading-snug">{opt.d}</span>
                    </button>
                )
            })}
        </div>
    </div>
  );
};

// 4. Community Garden (Match)
const MeaningGarden = ({ pool, onBack, onMastery }) => {
  const [roundData, setRoundData] = useState([]);
  const [selectedWord, setSelectedWord] = useState(null);
  const [matchedIds, setMatchedIds] = useState([]);

  useEffect(() => {
    const size = Math.min(pool.length, 3);
    const shuffled = [...pool].sort(() => 0.5 - Math.random()).slice(0, size);
    setRoundData(shuffled);
    setMatchedIds([]);
    setSelectedWord(null);
  }, [pool]);

  const handleWordClick = (word) => {
    if (matchedIds.includes(word)) return;
    setSelectedWord(word === selectedWord ? null : word);
  };

  const handleDefClick = (word) => {
    if (matchedIds.includes(word)) return;
    if (selectedWord === word) {
      setMatchedIds(prev => [...prev, word]);
      setSelectedWord(null);
      onMastery(); 
      if (matchedIds.length + 1 === roundData.length) {
        setTimeout(() => {
           const size = Math.min(pool.length, 3);
           const shuffled = [...pool].sort(() => 0.5 - Math.random()).slice(0, size);
           setRoundData(shuffled);
           setMatchedIds([]);
        }, 1500);
      }
    } else {
      setSelectedWord(null);
    }
  };

  return (
    <div className="flex flex-col h-full w-full p-4 animate-fadeIn">
      <div className="flex items-center justify-between w-full mb-6">
        <button onClick={onBack} className="flex items-center text-stone-600 hover:text-stone-800">
          <ArrowLeft size={20} className="mr-2" /> Garden
        </button>
        <div className="flex items-center gap-2 text-green-700">
          <Sprout size={20} /> <span className="font-bold">Planting Season</span>
        </div>
      </div>

      <div className="flex-1 flex flex-col md:flex-row gap-8 items-center justify-center max-w-5xl mx-auto w-full">
        <div className="flex-1 w-full space-y-4">
          <h3 className="text-center text-stone-400 text-sm uppercase tracking-widest mb-2">Seeds</h3>
          {roundData.map(item => {
            const isMatched = matchedIds.includes(item.w);
            const isSelected = selectedWord === item.w;
            return (
              <button
                key={`word-${item.w}`}
                onClick={() => handleWordClick(item.w)}
                disabled={isMatched}
                className={`w-full p-4 rounded-xl border-2 transition-all duration-300 relative overflow-hidden text-left
                  ${isMatched 
                    ? 'bg-green-50 border-green-200 opacity-50' 
                    : isSelected
                      ? 'bg-amber-100 border-amber-400 shadow-md scale-105 z-10'
                      : 'bg-white border-stone-200 hover:border-amber-300 hover:shadow-sm'
                  }`}
              >
                 <div className="flex items-center justify-between">
                    <span className={`text-lg font-bold ${isMatched ? 'text-green-800' : 'text-stone-800'}`}>{item.w}</span>
                    {isMatched && <Check size={20} className="text-green-600" />}
                 </div>
              </button>
            )
          })}
        </div>

        <div className="flex-1 w-full space-y-4">
          <h3 className="text-center text-stone-400 text-sm uppercase tracking-widest mb-2">Soil</h3>
          {roundData.sort((a,b) => a.w.localeCompare(b.w)).map(item => { // randomize visual order logic here
             const isMatched = matchedIds.includes(item.w);
             return (
               <button
                 key={`def-${item.w}`}
                 onClick={() => handleDefClick(item.w)}
                 disabled={isMatched}
                 className={`w-full p-4 rounded-xl border-2 transition-all duration-300 text-left h-auto min-h-[80px]
                   ${isMatched 
                     ? 'bg-green-100 border-green-300' 
                     : selectedWord 
                       ? 'bg-stone-50 border-stone-300 border-dashed hover:bg-green-50 hover:border-green-400'
                       : 'bg-stone-50 border-stone-200'
                   }`}
               >
                 {isMatched ? (
                    <div className="flex items-center justify-center gap-2 text-green-800 font-bold">
                        <Leaf className="fill-current" /> Planted!
                    </div>
                 ) : (
                    <span className="text-stone-600 text-sm leading-snug">{item.d}</span>
                 )}
               </button>
             )
          })}
        </div>
      </div>
    </div>
  );
}

// 5. Main Menu (The Garden Center)
const MainMenu = ({ onViewChange, progress, onBack }) => {
  const gardenLevel = Math.min(Math.floor(progress / 5), 5); 
  
  return (
    <div className="flex flex-col items-center w-full max-w-4xl mx-auto p-6 animate-fadeIn">
      
      <div className="w-full flex justify-start mb-4">
         <button onClick={onBack} className="text-stone-400 hover:text-stone-600 text-sm flex items-center gap-1">
            <ArrowLeft size={16}/> Select different units
         </button>
      </div>

      <header className="text-center mb-8 w-full">
        <h1 className="text-4xl md:text-5xl font-serif text-stone-800 mb-2">The Garden</h1>
        <p className="text-stone-500 italic">Choose a path to explore.</p>
      </header>

      {/* The Garden Dashboard */}
      <div className="w-full bg-gradient-to-b from-blue-50 to-white border border-stone-200 rounded-3xl p-8 mb-10 shadow-sm relative overflow-hidden">
        <div className="absolute top-4 right-4 text-yellow-400 animate-pulse-slow">
            <Sun size={48} className="fill-current" />
        </div>
        <div className="absolute top-8 left-10 text-blue-100">
            <Cloud size={64} className="fill-current" />
        </div>

        <div className="flex flex-col items-center justify-end h-32 relative z-10">
            <div className="flex items-end gap-2">
                {Array.from({ length: 5 }).map((_, i) => (
                    <div key={i} className={`transition-all duration-1000 ${i < gardenLevel ? 'opacity-100 translate-y-0' : 'opacity-20 translate-y-10 scale-0'}`}>
                        <Sprout size={32 + (i*8)} className={`text-green-${500 + (i*100)}`} />
                    </div>
                ))}
            </div>
            <div className="w-full h-4 bg-stone-300 rounded-full mt-2 opacity-50"></div>
            <p className="mt-4 text-stone-600 font-medium text-sm bg-white/80 px-4 py-1 rounded-full shadow-sm">
              Growth: {progress} Seeds Sprouted
            </p>
        </div>
      </div>

      {/* Invitations */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 w-full">
        
        <button 
            onClick={() => onViewChange('sketchbook')}
            className="group relative bg-white rounded-2xl p-5 shadow-sm border-2 border-stone-100 hover:border-blue-200 hover:shadow-md transition-all text-left flex flex-col h-40 justify-between overflow-hidden"
        >
            <div className="absolute -right-4 -top-4 bg-blue-50 w-20 h-20 rounded-full transition-transform group-hover:scale-150"></div>
            <div className="z-10 bg-blue-100 w-10 h-10 rounded-lg flex items-center justify-center text-blue-600 mb-2">
                <BookOpen size={20} />
            </div>
            <div className="z-10">
                <h3 className="text-lg font-bold text-stone-800 mb-1">Sketchbook</h3>
                <p className="text-xs text-stone-500">Study cards.</p>
            </div>
        </button>

        <button 
            onClick={() => onViewChange('quiz')}
            className="group relative bg-white rounded-2xl p-5 shadow-sm border-2 border-stone-100 hover:border-slate-200 hover:shadow-md transition-all text-left flex flex-col h-40 justify-between overflow-hidden"
        >
            <div className="absolute -right-4 -top-4 bg-slate-100 w-20 h-20 rounded-full transition-transform group-hover:scale-150"></div>
            <div className="z-10 bg-slate-200 w-10 h-10 rounded-lg flex items-center justify-center text-slate-700 mb-2">
                <Layers size={20} />
            </div>
            <div className="z-10">
                <h3 className="text-lg font-bold text-stone-800 mb-1">Pebble Paths</h3>
                <p className="text-xs text-stone-500">Find the meaning.</p>
            </div>
        </button>

        <button 
            onClick={() => onViewChange('workshop')}
            className="group relative bg-white rounded-2xl p-5 shadow-sm border-2 border-stone-100 hover:border-amber-200 hover:shadow-md transition-all text-left flex flex-col h-40 justify-between overflow-hidden"
        >
            <div className="absolute -right-4 -top-4 bg-amber-50 w-20 h-20 rounded-full transition-transform group-hover:scale-150"></div>
            <div className="z-10 bg-amber-100 w-10 h-10 rounded-lg flex items-center justify-center text-amber-700 mb-2">
                <Hammer size={20} />
            </div>
            <div className="z-10">
                <h3 className="text-lg font-bold text-stone-800 mb-1">Workshop</h3>
                <p className="text-xs text-stone-500">Build words.</p>
            </div>
        </button>

        <button 
            onClick={() => onViewChange('garden')}
            className="group relative bg-white rounded-2xl p-5 shadow-sm border-2 border-stone-100 hover:border-green-200 hover:shadow-md transition-all text-left flex flex-col h-40 justify-between overflow-hidden"
        >
            <div className="absolute -right-4 -top-4 bg-green-50 w-20 h-20 rounded-full transition-transform group-hover:scale-150"></div>
            <div className="z-10 bg-green-100 w-10 h-10 rounded-lg flex items-center justify-center text-green-700 mb-2">
                <Leaf size={20} />
            </div>
            <div className="z-10">
                <h3 className="text-lg font-bold text-stone-800 mb-1">Garden</h3>
                <p className="text-xs text-stone-500">Match seeds.</p>
            </div>
        </button>

      </div>
    </div>
  );
};

// --- MAIN APP CONTAINER ---
export default function App() {
  const [currentView, setCurrentView] = useState('selection');
  const [progress, setProgress] = useState(0);
  const [activeUnits, setActiveUnits] = useState([]);
  
  // Extract unique units from RAW_DATA
  const availableUnits = useMemo(() => {
    const units = new Set(RAW_DATA.map(i => i.u));
    return Array.from(units).sort();
  }, []);

  // Filter pool based on selection
  const activePool = useMemo(() => {
    if (activeUnits.length === 0) return [];
    return RAW_DATA.filter(item => activeUnits.includes(item.u));
  }, [activeUnits]);

  const handleStart = (selected) => {
    setActiveUnits(selected);
    setCurrentView('menu');
  };

  const handleMastery = () => {
    setProgress(prev => prev + 1);
  };

  return (
    <div className="min-h-screen bg-stone-50 font-sans text-stone-800 selection:bg-amber-100 flex flex-col">
      <style>{`
        .bg-paper-pattern {
          background-image: radial-gradient(#e7e5e4 1px, transparent 1px);
          background-size: 20px 20px;
        }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .perspective-1000 { perspective: 1000px; }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.6s ease-out forwards; }
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-5px); }
          75% { transform: translateX(5px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f5f5f4; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: #d6d3d1; border-radius: 20px; }
      `}</style>

      <main className="flex-grow flex items-center justify-center">
        {currentView === 'selection' && (
          <UnitSelection units={availableUnits} onStart={handleStart} />
        )}
        {currentView === 'menu' && (
          <MainMenu onViewChange={setCurrentView} progress={progress} onBack={() => setCurrentView('selection')} />
        )}
        {currentView === 'sketchbook' && (
          <Sketchbook pool={activePool} onBack={() => setCurrentView('menu')} onMastery={handleMastery} />
        )}
        {currentView === 'workshop' && (
          <WordWorkshop pool={activePool} onBack={() => setCurrentView('menu')} onMastery={handleMastery} />
        )}
        {currentView === 'garden' && (
          <MeaningGarden pool={activePool} onBack={() => setCurrentView('menu')} onMastery={handleMastery} />
        )}
        {currentView === 'quiz' && (
          <PebblePaths pool={activePool} onBack={() => setCurrentView('menu')} onMastery={handleMastery} />
        )}
      </main>
      
      <footer className="p-4 text-center text-stone-400 text-sm">
        <p>Vocabulary Garden  {activeUnits.length > 0 ? `${activeUnits.length} Unit(s) Active` : 'Select Units'}</p>
      </footer>
    </div>
  );
}
